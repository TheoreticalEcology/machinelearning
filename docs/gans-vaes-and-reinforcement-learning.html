<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 GANs, VAEs, and Reinforcement learning | Machine Learning and AI in TensorFlow and R</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="6 GANs, VAEs, and Reinforcement learning | Machine Learning and AI in TensorFlow and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 GANs, VAEs, and Reinforcement learning | Machine Learning and AI in TensorFlow and R" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Maximilian Pichler and Florian Hartig" />


<meta name="date" content="2021-04-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="xAI.html"/>

<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction to Machine Learning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#supervised-learning-regression-and-classification"><i class="fa fa-check"></i><b>2.1</b> Supervised learning: regression and classification</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction.html"><a href="introduction.html#supervised-regression-using-random-forest"><i class="fa fa-check"></i><b>2.1.1</b> Supervised regression using Random Forest</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction.html"><a href="introduction.html#supervised-classification-using-random-forest"><i class="fa fa-check"></i><b>2.1.2</b> Supervised classification using Random Forest</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#unsupervised-learning"><i class="fa fa-check"></i><b>2.2</b> Unsupervised learning</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction.html"><a href="introduction.html#k-means-clustering"><i class="fa fa-check"></i><b>2.2.1</b> k-means clustering</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#introduction-to-tensorflow"><i class="fa fa-check"></i><b>2.3</b> Introduction to Tensorflow</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction.html"><a href="introduction.html#tensorflow-data-containers"><i class="fa fa-check"></i><b>2.3.1</b> Tensorflow data containers</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction.html"><a href="introduction.html#tensorflow-data-types---good-practise-with-r-tf"><i class="fa fa-check"></i><b>2.3.2</b> Tensorflow data types - good practise with R-TF</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#first-steps-with-the-keras-framework"><i class="fa fa-check"></i><b>2.4</b> First steps with the keras framework</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction.html"><a href="introduction.html#example-workflow-in-keras"><i class="fa fa-check"></i><b>2.4.1</b> Example workflow in keras</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fund.html"><a href="fund.html"><i class="fa fa-check"></i><b>3</b> Fundamental principles and techniques</a>
<ul>
<li class="chapter" data-level="3.1" data-path="fund.html"><a href="fund.html#machine-learning-principles"><i class="fa fa-check"></i><b>3.1</b> Machine learning principles</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="fund.html"><a href="fund.html#optimization"><i class="fa fa-check"></i><b>3.1.1</b> Optimization</a></li>
<li class="chapter" data-level="3.1.2" data-path="fund.html"><a href="fund.html#regularization"><i class="fa fa-check"></i><b>3.1.2</b> Regularization</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="fund.html"><a href="fund.html#tree-based-ml-algorithms"><i class="fa fa-check"></i><b>3.2</b> Tree-based ML algorithms</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="fund.html"><a href="fund.html#classification-and-regression-trees"><i class="fa fa-check"></i><b>3.2.1</b> Classification and Regression Trees</a></li>
<li class="chapter" data-level="3.2.2" data-path="fund.html"><a href="fund.html#random-forest"><i class="fa fa-check"></i><b>3.2.2</b> Random Forest</a></li>
<li class="chapter" data-level="3.2.3" data-path="fund.html"><a href="fund.html#boosted-regression-trees"><i class="fa fa-check"></i><b>3.2.3</b> Boosted regression trees</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="fund.html"><a href="fund.html#distance-based-algorithms"><i class="fa fa-check"></i><b>3.3</b> Distance-based algorithms</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="fund.html"><a href="fund.html#k-nearest-neighbor"><i class="fa fa-check"></i><b>3.3.1</b> k-nearest-neighbor</a></li>
<li class="chapter" data-level="3.3.2" data-path="fund.html"><a href="fund.html#support-vector-machines-svm"><i class="fa fa-check"></i><b>3.3.2</b> Support Vector Machines (SVM)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="fund.html"><a href="fund.html#artificial-neural-networks"><i class="fa fa-check"></i><b>3.4</b> Artificial neural networks</a></li>
<li class="chapter" data-level="3.5" data-path="fund.html"><a href="fund.html#the-standard-ml-pipeline-at-the-example-of-the-titanic-dataset"><i class="fa fa-check"></i><b>3.5</b> The standard ML pipeline at the example of the titanic dataset</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="fund.html"><a href="fund.html#data-cleaning"><i class="fa fa-check"></i><b>3.5.1</b> Data cleaning</a></li>
<li class="chapter" data-level="3.5.2" data-path="fund.html"><a href="fund.html#pre-processing-and-feature-selection"><i class="fa fa-check"></i><b>3.5.2</b> Pre-processing and feature selection</a></li>
<li class="chapter" data-level="3.5.3" data-path="fund.html"><a href="fund.html#split-data-for-training-and-testing"><i class="fa fa-check"></i><b>3.5.3</b> Split data for training and testing</a></li>
<li class="chapter" data-level="3.5.4" data-path="fund.html"><a href="fund.html#model-fitting"><i class="fa fa-check"></i><b>3.5.4</b> Model fitting</a></li>
<li class="chapter" data-level="3.5.5" data-path="fund.html"><a href="fund.html#model-evaluation"><i class="fa fa-check"></i><b>3.5.5</b> Model evaluation</a></li>
<li class="chapter" data-level="3.5.6" data-path="fund.html"><a href="fund.html#predictions-and-submission"><i class="fa fa-check"></i><b>3.5.6</b> Predictions and submission</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Deep.html"><a href="Deep.html"><i class="fa fa-check"></i><b>4</b> Deep learning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Deep.html"><a href="Deep.html#deep-neural-networks"><i class="fa fa-check"></i><b>4.1</b> Deep Neural Networks</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="Deep.html"><a href="Deep.html#dropout-and-early-stopping"><i class="fa fa-check"></i><b>4.1.1</b> Dropout and Early stopping</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="Deep.html"><a href="Deep.html#convolutional-neural-networks---mnist"><i class="fa fa-check"></i><b>4.2</b> Convolutional Neural Networks - MNIST</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Deep.html"><a href="Deep.html#data-augmentation"><i class="fa fa-check"></i><b>4.2.1</b> Data Augmentation</a></li>
<li class="chapter" data-level="4.2.2" data-path="Deep.html"><a href="Deep.html#transfer-learning"><i class="fa fa-check"></i><b>4.2.2</b> Transfer learning</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Deep.html"><a href="Deep.html#flower-dataset"><i class="fa fa-check"></i><b>4.3</b> Flower dataset</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="xAI.html"><a href="xAI.html"><i class="fa fa-check"></i><b>5</b> Explainable AI (xAI), NLP, and RNNs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="xAI.html"><a href="xAI.html#xai-methods"><i class="fa fa-check"></i><b>5.1</b> xAI Methods</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="xAI.html"><a href="xAI.html#variable-importance"><i class="fa fa-check"></i><b>5.1.1</b> Variable Importance</a></li>
<li class="chapter" data-level="5.1.2" data-path="xAI.html"><a href="xAI.html#partial-dependencies"><i class="fa fa-check"></i><b>5.1.2</b> Partial dependencies</a></li>
<li class="chapter" data-level="5.1.3" data-path="xAI.html"><a href="xAI.html#accumulated-local-effects"><i class="fa fa-check"></i><b>5.1.3</b> Accumulated local effects</a></li>
<li class="chapter" data-level="5.1.4" data-path="xAI.html"><a href="xAI.html#friedmans-h-statistic"><i class="fa fa-check"></i><b>5.1.4</b> Friedmans H-statistic</a></li>
<li class="chapter" data-level="5.1.5" data-path="xAI.html"><a href="xAI.html#global-explainer---simplifying-the-ml-model"><i class="fa fa-check"></i><b>5.1.5</b> Global explainer - Simplifying the ML model</a></li>
<li class="chapter" data-level="5.1.6" data-path="xAI.html"><a href="xAI.html#local-explainer---lime-explaining-single-instances-observations"><i class="fa fa-check"></i><b>5.1.6</b> Local explainer - LIME explaining single instances (observations)</a></li>
<li class="chapter" data-level="5.1.7" data-path="xAI.html"><a href="xAI.html#local-explainer---shapley"><i class="fa fa-check"></i><b>5.1.7</b> Local explainer - Shapley</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="xAI.html"><a href="xAI.html#natural-language-processing-nlp"><i class="fa fa-check"></i><b>5.2</b> Natural Language Processing (NLP)</a></li>
<li class="chapter" data-level="5.3" data-path="xAI.html"><a href="xAI.html#recurrent-neural-networks-rnns"><i class="fa fa-check"></i><b>5.3</b> Recurrent neural networks (RNNs)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="gans-vaes-and-reinforcement-learning.html"><a href="gans-vaes-and-reinforcement-learning.html"><i class="fa fa-check"></i><b>6</b> GANs, VAEs, and Reinforcement learning</a>
<ul>
<li class="chapter" data-level="6.1" data-path="gans-vaes-and-reinforcement-learning.html"><a href="gans-vaes-and-reinforcement-learning.html#generative-adversarial-network-gans"><i class="fa fa-check"></i><b>6.1</b> Generative adversarial network (GANs)</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning and AI in TensorFlow and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gans-vaes-and-reinforcement-learning" class="section level1" number="6">
<h1><span class="header-section-number">6</span> GANs, VAEs, and Reinforcement learning</h1>
<div id="generative-adversarial-network-gans" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Generative adversarial network (GANs)</h2>
<p>The idea of generative adversarial network (GAN) is that two neural networks contest with each other in a game. On network is creating data and is trying to “trick” the other into thinking that this data is real. A possible application is to create pictures that look like real photographs. However, the application of GANs today is much wider than just the creation of data. For example, GANs can also be used to “augment” data, i.e. to create new data and thereby improve the fitted model.
### MNIST - GAN based on DNNs
GANs - two networks are playing against each other. The generator (similar to the decoder in AEs) creates new images from noise and tries to convince the discriminator that this is a real image.</p>
<p>The discriminator is getting a mix of true images (from the dataset) and of artificially generated images from the generator.</p>
<p>Loss of the generator - when fakes are identified as fakes by the discriminator (simple binary_crossentropy loss, 0/1…)</p>
<p>Loss of the discriminator - when fakes are identified as fakes (class 1) and true images as true images (class 0), again simple binary crossentropy.</p>
<p>MNIST example:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="gans-vaes-and-reinforcement-learning.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb224-2"><a href="gans-vaes-and-reinforcement-learning.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tensorflow)</span>
<span id="cb224-3"><a href="gans-vaes-and-reinforcement-learning.html#cb224-3" aria-hidden="true" tabindex="-1"></a>rotate <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">t</span>(<span class="fu">apply</span>(x, <span class="dv">2</span>, rev))</span>
<span id="cb224-4"><a href="gans-vaes-and-reinforcement-learning.html#cb224-4" aria-hidden="true" tabindex="-1"></a>imgPlot <span class="ot">=</span> <span class="cf">function</span>(img, <span class="at">title =</span> <span class="st">&quot;&quot;</span>){</span>
<span id="cb224-5"><a href="gans-vaes-and-reinforcement-learning.html#cb224-5" aria-hidden="true" tabindex="-1"></a> col<span class="ot">=</span><span class="fu">grey.colors</span>(<span class="dv">255</span>)</span>
<span id="cb224-6"><a href="gans-vaes-and-reinforcement-learning.html#cb224-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">image</span>(<span class="fu">rotate</span>(img), <span class="at">col =</span> col, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">&quot;Label: &quot;</span>, <span class="fu">as.character</span>(title)))</span>
<span id="cb224-7"><a href="gans-vaes-and-reinforcement-learning.html#cb224-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We don’t need the test set:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="gans-vaes-and-reinforcement-learning.html#cb225-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">dataset_mnist</span>()</span>
<span id="cb225-2"><a href="gans-vaes-and-reinforcement-learning.html#cb225-2" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> data<span class="sc">$</span>train</span>
<span id="cb225-3"><a href="gans-vaes-and-reinforcement-learning.html#cb225-3" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">=</span> <span class="fu">array</span>((train<span class="sc">$</span>x<span class="fl">-127.5</span>)<span class="sc">/</span><span class="fl">127.5</span>, <span class="fu">c</span>(<span class="fu">dim</span>(train<span class="sc">$</span>x)[<span class="dv">1</span>], 784L))</span></code></pre></div>
<p>Define and test generator model:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="gans-vaes-and-reinforcement-learning.html#cb226-1" aria-hidden="true" tabindex="-1"></a>get_generator <span class="ot">=</span> <span class="cf">function</span>(){</span>
<span id="cb226-2"><a href="gans-vaes-and-reinforcement-learning.html#cb226-2" aria-hidden="true" tabindex="-1"></a> generator <span class="ot">=</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb226-3"><a href="gans-vaes-and-reinforcement-learning.html#cb226-3" aria-hidden="true" tabindex="-1"></a> generator <span class="sc">%&gt;%</span> </span>
<span id="cb226-4"><a href="gans-vaes-and-reinforcement-learning.html#cb226-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_dense</span>(<span class="at">units =</span> 200L ,<span class="at">input_shape =</span> <span class="fu">c</span>(100L)) <span class="sc">%&gt;%</span> </span>
<span id="cb226-5"><a href="gans-vaes-and-reinforcement-learning.html#cb226-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_activation_leaky_relu</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb226-6"><a href="gans-vaes-and-reinforcement-learning.html#cb226-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_dense</span>(<span class="at">units =</span> 200L) <span class="sc">%&gt;%</span> </span>
<span id="cb226-7"><a href="gans-vaes-and-reinforcement-learning.html#cb226-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_activation_leaky_relu</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb226-8"><a href="gans-vaes-and-reinforcement-learning.html#cb226-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_dense</span>(<span class="at">units =</span> 784L, <span class="at">activation =</span> <span class="st">&quot;tanh&quot;</span>)</span>
<span id="cb226-9"><a href="gans-vaes-and-reinforcement-learning.html#cb226-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(generator)</span>
<span id="cb226-10"><a href="gans-vaes-and-reinforcement-learning.html#cb226-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="gans-vaes-and-reinforcement-learning.html#cb227-1" aria-hidden="true" tabindex="-1"></a>generator <span class="ot">=</span> <span class="fu">get_generator</span>()</span>
<span id="cb227-2"><a href="gans-vaes-and-reinforcement-learning.html#cb227-2" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">=</span> tf<span class="sc">$</span>random<span class="sc">$</span><span class="fu">normal</span>(<span class="fu">c</span>(1L, 100L))</span>
<span id="cb227-3"><a href="gans-vaes-and-reinforcement-learning.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="fu">imgPlot</span>(<span class="fu">array</span>(<span class="fu">generator</span>(sample)<span class="sc">$</span><span class="fu">numpy</span>(), <span class="fu">c</span>(28L, 28L)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
<p>The noise of size = [100] (random vector with 100 values) is passed through the network and the output correspond to the number of pixels of one MNIST image (784)</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="gans-vaes-and-reinforcement-learning.html#cb228-1" aria-hidden="true" tabindex="-1"></a>get_discriminator <span class="ot">=</span> <span class="cf">function</span>(){</span>
<span id="cb228-2"><a href="gans-vaes-and-reinforcement-learning.html#cb228-2" aria-hidden="true" tabindex="-1"></a> discriminator <span class="ot">=</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb228-3"><a href="gans-vaes-and-reinforcement-learning.html#cb228-3" aria-hidden="true" tabindex="-1"></a> discriminator <span class="sc">%&gt;%</span> </span>
<span id="cb228-4"><a href="gans-vaes-and-reinforcement-learning.html#cb228-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_dense</span>(<span class="at">units =</span> 200L, <span class="at">input_shape =</span> <span class="fu">c</span>(784L)) <span class="sc">%&gt;%</span> </span>
<span id="cb228-5"><a href="gans-vaes-and-reinforcement-learning.html#cb228-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_activation_leaky_relu</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb228-6"><a href="gans-vaes-and-reinforcement-learning.html#cb228-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_dense</span>(<span class="at">units =</span> 100L) <span class="sc">%&gt;%</span> </span>
<span id="cb228-7"><a href="gans-vaes-and-reinforcement-learning.html#cb228-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_activation_leaky_relu</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb228-8"><a href="gans-vaes-and-reinforcement-learning.html#cb228-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">layer_dense</span>(<span class="at">units =</span> 1L, <span class="at">activation =</span> <span class="st">&quot;sigmoid&quot;</span>)</span>
<span id="cb228-9"><a href="gans-vaes-and-reinforcement-learning.html#cb228-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(discriminator)</span>
<span id="cb228-10"><a href="gans-vaes-and-reinforcement-learning.html#cb228-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="gans-vaes-and-reinforcement-learning.html#cb229-1" aria-hidden="true" tabindex="-1"></a>discriminator <span class="ot">=</span> <span class="fu">get_discriminator</span>()</span>
<span id="cb229-2"><a href="gans-vaes-and-reinforcement-learning.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">discriminator</span>(<span class="fu">generator</span>(tf<span class="sc">$</span>random<span class="sc">$</span><span class="fu">normal</span>(<span class="fu">c</span>(1L, 100L))))</span></code></pre></div>
<pre><code>## tf.Tensor([[0.46562877]], shape=(1, 1), dtype=float32)</code></pre>
<p>The normal architecture of a binary classifier (will get images as input)</p>
<p>Loss:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="gans-vaes-and-reinforcement-learning.html#cb231-1" aria-hidden="true" tabindex="-1"></a>ce <span class="ot">=</span> tf<span class="sc">$</span>keras<span class="sc">$</span>losses<span class="sc">$</span><span class="fu">BinaryCrossentropy</span>(<span class="at">from_logits =</span> <span class="cn">TRUE</span>)</span>
<span id="cb231-2"><a href="gans-vaes-and-reinforcement-learning.html#cb231-2" aria-hidden="true" tabindex="-1"></a>loss_discriminator <span class="ot">=</span> <span class="cf">function</span>(real, fake){</span>
<span id="cb231-3"><a href="gans-vaes-and-reinforcement-learning.html#cb231-3" aria-hidden="true" tabindex="-1"></a> real_loss <span class="ot">=</span> <span class="fu">ce</span>(tf<span class="sc">$</span><span class="fu">ones_like</span>(real), real)</span>
<span id="cb231-4"><a href="gans-vaes-and-reinforcement-learning.html#cb231-4" aria-hidden="true" tabindex="-1"></a> fake_loss <span class="ot">=</span> <span class="fu">ce</span>(tf<span class="sc">$</span><span class="fu">zeros_like</span>(fake), fake)</span>
<span id="cb231-5"><a href="gans-vaes-and-reinforcement-learning.html#cb231-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(real_loss<span class="sc">+</span>fake_loss)</span>
<span id="cb231-6"><a href="gans-vaes-and-reinforcement-learning.html#cb231-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb231-7"><a href="gans-vaes-and-reinforcement-learning.html#cb231-7" aria-hidden="true" tabindex="-1"></a>loss_generator <span class="ot">=</span> <span class="cf">function</span>(fake){</span>
<span id="cb231-8"><a href="gans-vaes-and-reinforcement-learning.html#cb231-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">ce</span>(tf<span class="sc">$</span><span class="fu">ones_like</span>(fake), fake))</span>
<span id="cb231-9"><a href="gans-vaes-and-reinforcement-learning.html#cb231-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Binary crossentropy as loss function.</p>
<p>However, we have to encode the true and predicted values for the two networks individually.</p>
<p>The discriminator will get two losses - one for identifying fake images as fake, and one for identifying real MNIST images as real images.</p>
<p>The generator will just get one loss - was it able to deceive the discriminator?</p>
<p>Each network will get its own optimizer (while a AE will be treated as one network, in a GAN the networks will be treated independently)</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="gans-vaes-and-reinforcement-learning.html#cb232-1" aria-hidden="true" tabindex="-1"></a>gen_opt <span class="ot">=</span> tf<span class="sc">$</span>keras<span class="sc">$</span>optimizers<span class="sc">$</span><span class="fu">RMSprop</span>(<span class="fl">1e-4</span>)</span>
<span id="cb232-2"><a href="gans-vaes-and-reinforcement-learning.html#cb232-2" aria-hidden="true" tabindex="-1"></a>disc_opt <span class="ot">=</span> tf<span class="sc">$</span>keras<span class="sc">$</span>optimizers<span class="sc">$</span><span class="fu">RMSprop</span>(<span class="fl">1e-4</span>)</span>
<span id="cb232-3"><a href="gans-vaes-and-reinforcement-learning.html#cb232-3" aria-hidden="true" tabindex="-1"></a>batch_size <span class="ot">=</span> 32L</span>
<span id="cb232-4"><a href="gans-vaes-and-reinforcement-learning.html#cb232-4" aria-hidden="true" tabindex="-1"></a>get_batch <span class="ot">=</span> <span class="cf">function</span>(){  <span class="co"># Helper function to get batches of images</span></span>
<span id="cb232-5"><a href="gans-vaes-and-reinforcement-learning.html#cb232-5" aria-hidden="true" tabindex="-1"></a> indices <span class="ot">=</span> <span class="fu">sample.int</span>(<span class="fu">nrow</span>(train_x), batch_size)</span>
<span id="cb232-6"><a href="gans-vaes-and-reinforcement-learning.html#cb232-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(tf<span class="sc">$</span><span class="fu">constant</span>(train_x[indices,], <span class="st">&quot;float32&quot;</span>))</span>
<span id="cb232-7"><a href="gans-vaes-and-reinforcement-learning.html#cb232-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We have to write here our own training loop (we cannot use the fit function). Let’s define a training function:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="gans-vaes-and-reinforcement-learning.html#cb233-1" aria-hidden="true" tabindex="-1"></a>train_step <span class="ot">=</span> <span class="cf">function</span>(images){</span>
<span id="cb233-2"><a href="gans-vaes-and-reinforcement-learning.html#cb233-2" aria-hidden="true" tabindex="-1"></a> noise <span class="ot">=</span> tf<span class="sc">$</span>random<span class="sc">$</span><span class="fu">normal</span>(<span class="fu">c</span>(32L, 100L))</span>
<span id="cb233-3"><a href="gans-vaes-and-reinforcement-learning.html#cb233-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">with</span>(tf<span class="sc">$</span><span class="fu">GradientTape</span>(<span class="at">persistent =</span> <span class="cn">TRUE</span>) <span class="sc">%as%</span> tape,{</span>
<span id="cb233-4"><a href="gans-vaes-and-reinforcement-learning.html#cb233-4" aria-hidden="true" tabindex="-1"></a> gen_images <span class="ot">=</span> <span class="fu">generator</span>(noise)</span>
<span id="cb233-5"><a href="gans-vaes-and-reinforcement-learning.html#cb233-5" aria-hidden="true" tabindex="-1"></a> fake_output <span class="ot">=</span> <span class="fu">discriminator</span>(gen_images)</span>
<span id="cb233-6"><a href="gans-vaes-and-reinforcement-learning.html#cb233-6" aria-hidden="true" tabindex="-1"></a> real_output <span class="ot">=</span> <span class="fu">discriminator</span>(images)</span>
<span id="cb233-7"><a href="gans-vaes-and-reinforcement-learning.html#cb233-7" aria-hidden="true" tabindex="-1"></a> gen_loss <span class="ot">=</span> <span class="fu">loss_generator</span>(fake_output)</span>
<span id="cb233-8"><a href="gans-vaes-and-reinforcement-learning.html#cb233-8" aria-hidden="true" tabindex="-1"></a> disc_loss <span class="ot">=</span> <span class="fu">loss_discriminator</span>(real_output, fake_output)</span>
<span id="cb233-9"><a href="gans-vaes-and-reinforcement-learning.html#cb233-9" aria-hidden="true" tabindex="-1"></a> })</span>
<span id="cb233-10"><a href="gans-vaes-and-reinforcement-learning.html#cb233-10" aria-hidden="true" tabindex="-1"></a> gen_grads <span class="ot">=</span> tape<span class="sc">$</span><span class="fu">gradient</span>(gen_loss, generator<span class="sc">$</span>weights)</span>
<span id="cb233-11"><a href="gans-vaes-and-reinforcement-learning.html#cb233-11" aria-hidden="true" tabindex="-1"></a> disc_grads <span class="ot">=</span> tape<span class="sc">$</span><span class="fu">gradient</span>(disc_loss, discriminator<span class="sc">$</span>weights)</span>
<span id="cb233-12"><a href="gans-vaes-and-reinforcement-learning.html#cb233-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">rm</span>(tape)</span>
<span id="cb233-13"><a href="gans-vaes-and-reinforcement-learning.html#cb233-13" aria-hidden="true" tabindex="-1"></a> gen_opt<span class="sc">$</span><span class="fu">apply_gradients</span>(purrr<span class="sc">::</span><span class="fu">transpose</span>(<span class="fu">list</span>(gen_grads, generator<span class="sc">$</span>weights)))</span>
<span id="cb233-14"><a href="gans-vaes-and-reinforcement-learning.html#cb233-14" aria-hidden="true" tabindex="-1"></a> disc_opt<span class="sc">$</span><span class="fu">apply_gradients</span>(purrr<span class="sc">::</span><span class="fu">transpose</span>(<span class="fu">list</span>(disc_grads, discriminator<span class="sc">$</span>weights)))</span>
<span id="cb233-15"><a href="gans-vaes-and-reinforcement-learning.html#cb233-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(<span class="fu">c</span>(gen_loss, disc_loss))</span>
<span id="cb233-16"><a href="gans-vaes-and-reinforcement-learning.html#cb233-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb233-17"><a href="gans-vaes-and-reinforcement-learning.html#cb233-17" aria-hidden="true" tabindex="-1"></a>train_step <span class="ot">=</span> tf<span class="sc">$</span><span class="st">`</span><span class="at">function</span><span class="st">`</span>(reticulate<span class="sc">::</span><span class="fu">py_func</span>(train_step))</span></code></pre></div>
<p>In each iteration (for each batch) we will do the following (the GradientTape records computations to do automatic differenation):</p>
<ol style="list-style-type: decimal">
<li>sample noise</li>
<li>Generator creates images from the noise</li>
<li>Discriminator will make predictions for fake images and real images (response is a probability between [0,1])</li>
<li>Calculate loss for generator</li>
<li>Calculate loss for discriminator</li>
<li>Calculate gradients for weights and the loss</li>
<li>Update weights of generator</li>
<li>Update weights of discriminator</li>
<li>return losses</li>
</ol>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="gans-vaes-and-reinforcement-learning.html#cb234-1" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">nrow</span>(train_x)<span class="sc">/</span>batch_size)</span>
<span id="cb234-2"><a href="gans-vaes-and-reinforcement-learning.html#cb234-2" aria-hidden="true" tabindex="-1"></a>generator <span class="ot">=</span> <span class="fu">get_generator</span>()</span>
<span id="cb234-3"><a href="gans-vaes-and-reinforcement-learning.html#cb234-3" aria-hidden="true" tabindex="-1"></a>discriminator <span class="ot">=</span> <span class="fu">get_discriminator</span>()</span>
<span id="cb234-4"><a href="gans-vaes-and-reinforcement-learning.html#cb234-4" aria-hidden="true" tabindex="-1"></a>epochs <span class="ot">=</span> 30L</span>
<span id="cb234-5"><a href="gans-vaes-and-reinforcement-learning.html#cb234-5" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">nrow</span>(train_x)<span class="sc">/</span>batch_size)</span>
<span id="cb234-6"><a href="gans-vaes-and-reinforcement-learning.html#cb234-6" aria-hidden="true" tabindex="-1"></a>counter <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb234-7"><a href="gans-vaes-and-reinforcement-learning.html#cb234-7" aria-hidden="true" tabindex="-1"></a>gen_loss <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb234-8"><a href="gans-vaes-and-reinforcement-learning.html#cb234-8" aria-hidden="true" tabindex="-1"></a>disc_loss <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb234-9"><a href="gans-vaes-and-reinforcement-learning.html#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(epochs<span class="sc">*</span>steps)){</span>
<span id="cb234-10"><a href="gans-vaes-and-reinforcement-learning.html#cb234-10" aria-hidden="true" tabindex="-1"></a> images <span class="ot">=</span> <span class="fu">get_batch</span>()</span>
<span id="cb234-11"><a href="gans-vaes-and-reinforcement-learning.html#cb234-11" aria-hidden="true" tabindex="-1"></a> losses <span class="ot">=</span> <span class="fu">train_step</span>(images)</span>
<span id="cb234-12"><a href="gans-vaes-and-reinforcement-learning.html#cb234-12" aria-hidden="true" tabindex="-1"></a> gen_loss <span class="ot">=</span> tf<span class="sc">$</span><span class="fu">reduce_sum</span>(losses[[<span class="dv">1</span>]])<span class="sc">$</span><span class="fu">numpy</span>()</span>
<span id="cb234-13"><a href="gans-vaes-and-reinforcement-learning.html#cb234-13" aria-hidden="true" tabindex="-1"></a> disc_loss <span class="ot">=</span> tf<span class="sc">$</span><span class="fu">reduce_sum</span>(losses[[<span class="dv">2</span>]])<span class="sc">$</span><span class="fu">numpy</span>()</span>
<span id="cb234-14"><a href="gans-vaes-and-reinforcement-learning.html#cb234-14" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(i <span class="sc">%%</span> <span class="dv">50</span><span class="sc">*</span>steps <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb234-15"><a href="gans-vaes-and-reinforcement-learning.html#cb234-15" aria-hidden="true" tabindex="-1"></a> noise <span class="ot">=</span> tf<span class="sc">$</span>random<span class="sc">$</span><span class="fu">normal</span>(<span class="fu">c</span>(1L, 100L))</span>
<span id="cb234-16"><a href="gans-vaes-and-reinforcement-learning.html#cb234-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">imgPlot</span>(<span class="fu">array</span>(<span class="fu">generator</span>(noise)<span class="sc">$</span><span class="fu">numpy</span>(), <span class="fu">c</span>(28L, 28L)), <span class="st">&quot;Gen&quot;</span>)</span>
<span id="cb234-17"><a href="gans-vaes-and-reinforcement-learning.html#cb234-17" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb234-18"><a href="gans-vaes-and-reinforcement-learning.html#cb234-18" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(i <span class="sc">%%</span> steps <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb234-19"><a href="gans-vaes-and-reinforcement-learning.html#cb234-19" aria-hidden="true" tabindex="-1"></a> counter <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb234-20"><a href="gans-vaes-and-reinforcement-learning.html#cb234-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">cat</span>(<span class="st">&quot;Gen: &quot;</span>, <span class="fu">mean</span>(gen_loss), <span class="st">&quot; Disc: &quot;</span>, <span class="fu">mean</span>(disc_loss), <span class="st">&quot; </span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb234-21"><a href="gans-vaes-and-reinforcement-learning.html#cb234-21" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb234-22"><a href="gans-vaes-and-reinforcement-learning.html#cb234-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The actual training loop:</p>
<ol style="list-style-type: decimal">
<li>Create networks</li>
<li>get batch of images</li>
<li>run train_step function</li>
<li>print losses</li>
<li>repeat step 2-4 for number of epochs</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="xAI.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
