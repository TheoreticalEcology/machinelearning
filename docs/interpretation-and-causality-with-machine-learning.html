<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Interpretation and causality with machine learning | Machine Learning and AI in TensorFlow and R</title>
  <meta name="description" content="5 Interpretation and causality with machine learning | Machine Learning and AI in TensorFlow and R" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Interpretation and causality with machine learning | Machine Learning and AI in TensorFlow and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="5 Interpretation and causality with machine learning | Machine Learning and AI in TensorFlow and R" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Interpretation and causality with machine learning | Machine Learning and AI in TensorFlow and R" />
  
  <meta name="twitter:description" content="5 Interpretation and causality with machine learning | Machine Learning and AI in TensorFlow and R" />
  

<meta name="author" content="Maximilian Pichler and Florian Hartig" />


<meta name="date" content="2021-05-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Deep.html"/>
<link rel="next" href="generative-modeling-and-reinforcement-learning.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction to Machine Learning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#unsupervised-learning"><i class="fa fa-check"></i><b>2.1</b> Unsupervised learning</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction.html"><a href="introduction.html#hierarchical-clustering"><i class="fa fa-check"></i><b>2.1.1</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction.html"><a href="introduction.html#k-means-clustering"><i class="fa fa-check"></i><b>2.1.2</b> k-means clustering</a></li>
<li class="chapter" data-level="2.1.3" data-path="introduction.html"><a href="introduction.html#density-based-clustering"><i class="fa fa-check"></i><b>2.1.3</b> Density-based clustering</a></li>
<li class="chapter" data-level="2.1.4" data-path="introduction.html"><a href="introduction.html#model-based-clustering"><i class="fa fa-check"></i><b>2.1.4</b> Model-based clustering</a></li>
<li class="chapter" data-level="2.1.5" data-path="introduction.html"><a href="introduction.html#ordination"><i class="fa fa-check"></i><b>2.1.5</b> Ordination</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#supervised-learning-regression-and-classification"><i class="fa fa-check"></i><b>2.2</b> Supervised learning: regression and classification</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction.html"><a href="introduction.html#supervised-regression-using-random-forest"><i class="fa fa-check"></i><b>2.2.1</b> Supervised regression using Random Forest</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction.html"><a href="introduction.html#supervised-classification-using-random-forest"><i class="fa fa-check"></i><b>2.2.2</b> Supervised classification using Random Forest</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#introduction-to-tensorflow"><i class="fa fa-check"></i><b>2.3</b> Introduction to Tensorflow</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction.html"><a href="introduction.html#tensorflow-data-containers"><i class="fa fa-check"></i><b>2.3.1</b> Tensorflow data containers</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction.html"><a href="introduction.html#tensorflow-data-types---good-practise-with-r-tf"><i class="fa fa-check"></i><b>2.3.2</b> Tensorflow data types - good practise with R-TF</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#introduction-to-pytorch"><i class="fa fa-check"></i><b>2.4</b> Introduction to PyTorch</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction.html"><a href="introduction.html#pytorch-data-containers"><i class="fa fa-check"></i><b>2.4.1</b> PyTorch data containers</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction.html"><a href="introduction.html#torch-data-types---good-practise-with-r-tf"><i class="fa fa-check"></i><b>2.4.2</b> Torch data types - good practise with R-TF</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#first-steps-with-the-keras-framework"><i class="fa fa-check"></i><b>2.5</b> First steps with the keras framework</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction.html"><a href="introduction.html#example-workflow-in-keras"><i class="fa fa-check"></i><b>2.5.1</b> Example workflow in keras</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fund.html"><a href="fund.html"><i class="fa fa-check"></i><b>3</b> Fundamental principles and techniques</a>
<ul>
<li class="chapter" data-level="3.1" data-path="fund.html"><a href="fund.html#machine-learning-principles"><i class="fa fa-check"></i><b>3.1</b> Machine learning principles</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="fund.html"><a href="fund.html#optimization"><i class="fa fa-check"></i><b>3.1.1</b> Optimization</a></li>
<li class="chapter" data-level="3.1.2" data-path="fund.html"><a href="fund.html#regularization"><i class="fa fa-check"></i><b>3.1.2</b> Regularization</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="fund.html"><a href="fund.html#tree-based-ml-algorithms"><i class="fa fa-check"></i><b>3.2</b> Tree-based ML algorithms</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="fund.html"><a href="fund.html#classification-and-regression-trees"><i class="fa fa-check"></i><b>3.2.1</b> Classification and Regression Trees</a></li>
<li class="chapter" data-level="3.2.2" data-path="fund.html"><a href="fund.html#random-forest"><i class="fa fa-check"></i><b>3.2.2</b> Random Forest</a></li>
<li class="chapter" data-level="3.2.3" data-path="fund.html"><a href="fund.html#boosted-regression-trees"><i class="fa fa-check"></i><b>3.2.3</b> Boosted regression trees</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="fund.html"><a href="fund.html#distance-based-algorithms"><i class="fa fa-check"></i><b>3.3</b> Distance-based algorithms</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="fund.html"><a href="fund.html#k-nearest-neighbor"><i class="fa fa-check"></i><b>3.3.1</b> k-nearest-neighbor</a></li>
<li class="chapter" data-level="3.3.2" data-path="fund.html"><a href="fund.html#support-vector-machines-svm"><i class="fa fa-check"></i><b>3.3.2</b> Support Vector Machines (SVM)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="fund.html"><a href="fund.html#artificial-neural-networks"><i class="fa fa-check"></i><b>3.4</b> Artificial neural networks</a></li>
<li class="chapter" data-level="3.5" data-path="fund.html"><a href="fund.html#the-standard-ml-pipeline-at-the-example-of-the-titanic-dataset"><i class="fa fa-check"></i><b>3.5</b> The standard ML pipeline at the example of the titanic dataset</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="fund.html"><a href="fund.html#data-cleaning"><i class="fa fa-check"></i><b>3.5.1</b> Data cleaning</a></li>
<li class="chapter" data-level="3.5.2" data-path="fund.html"><a href="fund.html#pre-processing-and-feature-selection"><i class="fa fa-check"></i><b>3.5.2</b> Pre-processing and feature selection</a></li>
<li class="chapter" data-level="3.5.3" data-path="fund.html"><a href="fund.html#split-data-for-training-and-testing"><i class="fa fa-check"></i><b>3.5.3</b> Split data for training and testing</a></li>
<li class="chapter" data-level="3.5.4" data-path="fund.html"><a href="fund.html#model-fitting"><i class="fa fa-check"></i><b>3.5.4</b> Model fitting</a></li>
<li class="chapter" data-level="3.5.5" data-path="fund.html"><a href="fund.html#model-evaluation"><i class="fa fa-check"></i><b>3.5.5</b> Model evaluation</a></li>
<li class="chapter" data-level="3.5.6" data-path="fund.html"><a href="fund.html#predictions-and-submission"><i class="fa fa-check"></i><b>3.5.6</b> Predictions and submission</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="fund.html"><a href="fund.html#mlr"><i class="fa fa-check"></i><b>3.6</b> Bonus - ML pipelines with mlr3</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="fund.html"><a href="fund.html#mlr3---the-basic-workflow"><i class="fa fa-check"></i><b>3.6.1</b> mlr3 - the basic workflow</a></li>
<li class="chapter" data-level="3.6.2" data-path="fund.html"><a href="fund.html#mlr3---hyper-parameter-tuning"><i class="fa fa-check"></i><b>3.6.2</b> mlr3 - hyper-parameter tuning</a></li>
<li class="chapter" data-level="3.6.3" data-path="fund.html"><a href="fund.html#mlr3---hyper-parameter-tuning-with-oversampling"><i class="fa fa-check"></i><b>3.6.3</b> mlr3 - hyper-parameter tuning with oversampling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Deep.html"><a href="Deep.html"><i class="fa fa-check"></i><b>4</b> Deep learning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Deep.html"><a href="Deep.html#network-architectures"><i class="fa fa-check"></i><b>4.1</b> Network architectures</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="Deep.html"><a href="Deep.html#deep-neural-networks-dnns"><i class="fa fa-check"></i><b>4.1.1</b> Deep neural networks (DNNs)</a></li>
<li class="chapter" data-level="4.1.2" data-path="Deep.html"><a href="Deep.html#convolutional-neural-networks-dnns"><i class="fa fa-check"></i><b>4.1.2</b> Convolutional neural networks (DNNs)</a></li>
<li class="chapter" data-level="4.1.3" data-path="Deep.html"><a href="Deep.html#recurrent-neural-networks-rnns"><i class="fa fa-check"></i><b>4.1.3</b> Recurrent neural networks (RNNs)</a></li>
<li class="chapter" data-level="4.1.4" data-path="Deep.html"><a href="Deep.html#natural-language-processing-nlp"><i class="fa fa-check"></i><b>4.1.4</b> Natural language processing (NLP)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="Deep.html"><a href="Deep.html#case-study-dropout-and-early-stopping-in-a-deep-neural-network"><i class="fa fa-check"></i><b>4.2</b> Case study: dropout and early stopping in a deep neural network</a></li>
<li class="chapter" data-level="4.3" data-path="Deep.html"><a href="Deep.html#case-study---fitting-a-convolutional-neural-networks-on-mnist"><i class="fa fa-check"></i><b>4.3</b> Case study - fitting a Convolutional Neural Networks on MNIST</a></li>
<li class="chapter" data-level="4.4" data-path="Deep.html"><a href="Deep.html#advanced-training-techniques"><i class="fa fa-check"></i><b>4.4</b> Advanced training techniques</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="Deep.html"><a href="Deep.html#data-augmentation"><i class="fa fa-check"></i><b>4.4.1</b> Data Augmentation</a></li>
<li class="chapter" data-level="4.4.2" data-path="Deep.html"><a href="Deep.html#transfer"><i class="fa fa-check"></i><b>4.4.2</b> Transfer learning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html"><i class="fa fa-check"></i><b>5</b> Interpretation and causality with machine learning</a>
<ul>
<li class="chapter" data-level="5.1" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#explainable-ai"><i class="fa fa-check"></i><b>5.1</b> Explainable AI</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#a-practical-example"><i class="fa fa-check"></i><b>5.1.1</b> A practical example</a></li>
<li class="chapter" data-level="5.1.2" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#feature-importance"><i class="fa fa-check"></i><b>5.1.2</b> Feature Importance</a></li>
<li class="chapter" data-level="5.1.3" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#partial-dependencies"><i class="fa fa-check"></i><b>5.1.3</b> Partial dependencies</a></li>
<li class="chapter" data-level="5.1.4" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#accumulated-local-effects"><i class="fa fa-check"></i><b>5.1.4</b> Accumulated local effects</a></li>
<li class="chapter" data-level="5.1.5" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#friedmans-h-statistic"><i class="fa fa-check"></i><b>5.1.5</b> Friedmans H-statistic</a></li>
<li class="chapter" data-level="5.1.6" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#global-explainer---simplifying-the-ml-model"><i class="fa fa-check"></i><b>5.1.6</b> Global explainer - Simplifying the ML model</a></li>
<li class="chapter" data-level="5.1.7" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#local-explainer---lime-explaining-single-instances-observations"><i class="fa fa-check"></i><b>5.1.7</b> Local explainer - LIME explaining single instances (observations)</a></li>
<li class="chapter" data-level="5.1.8" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#local-explainer---shapley"><i class="fa fa-check"></i><b>5.1.8</b> Local explainer - Shapley</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#causal-inference-and-machine-learning"><i class="fa fa-check"></i><b>5.2</b> Causal inference and machine learning</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#causal-inference-on-static-data"><i class="fa fa-check"></i><b>5.2.1</b> Causal inference on static data</a></li>
<li class="chapter" data-level="5.2.2" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#structural-equation-models"><i class="fa fa-check"></i><b>5.2.2</b> Structural equation models</a></li>
<li class="chapter" data-level="5.2.3" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#automatic-causal-discovery"><i class="fa fa-check"></i><b>5.2.3</b> Automatic causal discovery</a></li>
<li class="chapter" data-level="5.2.4" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#causal-inference-on-dynamic-data"><i class="fa fa-check"></i><b>5.2.4</b> Causal inference on dynamic data</a></li>
<li class="chapter" data-level="5.2.5" data-path="interpretation-and-causality-with-machine-learning.html"><a href="interpretation-and-causality-with-machine-learning.html#outlook-for-machine-learning"><i class="fa fa-check"></i><b>5.2.5</b> Outlook for machine learning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html"><i class="fa fa-check"></i><b>6</b> Generative modeling and reinforcement learning</a>
<ul>
<li class="chapter" data-level="6.1" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#autoencoder"><i class="fa fa-check"></i><b>6.1</b> Autoencoder</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#autoencoder---dnn-mnist"><i class="fa fa-check"></i><b>6.1.1</b> Autoencoder - DNN MNIST</a></li>
<li class="chapter" data-level="6.1.2" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#autoencoder---mnist-cnn"><i class="fa fa-check"></i><b>6.1.2</b> Autoencoder - MNIST CNN</a></li>
<li class="chapter" data-level="6.1.3" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#varational-autoencoder"><i class="fa fa-check"></i><b>6.1.3</b> Varational Autoencoder</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#generative-adversarial-network-gans"><i class="fa fa-check"></i><b>6.2</b> Generative adversarial network (GANs)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#mnist---gan-based-on-dnns"><i class="fa fa-check"></i><b>6.2.1</b> MNIST - GAN based on DNNs</a></li>
<li class="chapter" data-level="6.2.2" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#flower---gan"><i class="fa fa-check"></i><b>6.2.2</b> Flower - GAN</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="generative-modeling-and-reinforcement-learning.html"><a href="generative-modeling-and-reinforcement-learning.html#reinforcement-learning"><i class="fa fa-check"></i><b>6.3</b> Reinforcement learning</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="datasets.html"><a href="datasets.html"><i class="fa fa-check"></i><b>7</b> Datasets</a>
<ul>
<li class="chapter" data-level="7.1" data-path="datasets.html"><a href="datasets.html#titanic"><i class="fa fa-check"></i><b>7.1</b> Titanic</a></li>
<li class="chapter" data-level="7.2" data-path="datasets.html"><a href="datasets.html#plant-pollinator-database"><i class="fa fa-check"></i><b>7.2</b> Plant-pollinator database</a></li>
<li class="chapter" data-level="7.3" data-path="datasets.html"><a href="datasets.html#wine"><i class="fa fa-check"></i><b>7.3</b> Wine</a></li>
<li class="chapter" data-level="7.4" data-path="datasets.html"><a href="datasets.html#nasa"><i class="fa fa-check"></i><b>7.4</b> Nasa</a></li>
<li class="chapter" data-level="7.5" data-path="datasets.html"><a href="datasets.html#flower"><i class="fa fa-check"></i><b>7.5</b> Flower</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning and AI in TensorFlow and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interpretation-and-causality-with-machine-learning" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Interpretation and causality with machine learning</h1>
<div id="explainable-ai" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Explainable AI</h2>
<p>The goal of explainable AI (xAI, aka interpretable machine learning) is to explain WHY a fitted ML models makes certain predictions. A typical example is to understand how important different variables are for predictions. There incentives to do so range from a better technical understanding of the models over understanding which data is important to improve predictions to questions of fairness and discrimination (e.g. to understand if an algorithm uses skin color to make a decision).</p>
<div id="a-practical-example" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> A practical example</h3>
<p>In this lecture we will work with another famous dataset, the Boston housing dataset:</p>
<p>We will fit a random forest and use the iml pkg for xAI, see <img src="https://christophm.github.io/interpretable-ml-book/" /></p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="interpretation-and-causality-with-machine-learning.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb364-2"><a href="interpretation-and-causality-with-machine-learning.html#cb364-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;iml&quot;</span>)</span>
<span id="cb364-3"><a href="interpretation-and-causality-with-machine-learning.html#cb364-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;randomForest&quot;</span>)</span>
<span id="cb364-4"><a href="interpretation-and-causality-with-machine-learning.html#cb364-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Boston&quot;</span>, <span class="at">package =</span> <span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb364-5"><a href="interpretation-and-causality-with-machine-learning.html#cb364-5" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">=</span> <span class="fu">randomForest</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston, <span class="at">ntree =</span> <span class="dv">50</span>)</span></code></pre></div>
<p>xAI packages are written generic, i.e. they can handle almost all ML models.
When we want to use them, we first have to create a Predictor object, that holds the model and the data. The iml package uses R6 classes, that means new objects can be created by calling Predictor$new(). (do not worry if you do not know what R6 classes are, just use the command)</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="interpretation-and-causality-with-machine-learning.html#cb365-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> Boston[<span class="fu">which</span>(<span class="fu">names</span>(Boston) <span class="sc">!=</span> <span class="st">&quot;medv&quot;</span>)]</span>
<span id="cb365-2"><a href="interpretation-and-causality-with-machine-learning.html#cb365-2" aria-hidden="true" tabindex="-1"></a>predictor <span class="ot">=</span> Predictor<span class="sc">$</span><span class="fu">new</span>(rf, <span class="at">data =</span> X, <span class="at">y =</span> Boston<span class="sc">$</span>medv)</span></code></pre></div>
</div>
<div id="feature-importance" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Feature Importance</h3>
<p>Feature importance, should not be mistaken with the RF variable importance. It tells us how important the individual variables are for predictions and can be calculated for all ML models and is based on a permutation approach (have a look at the book):</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="interpretation-and-causality-with-machine-learning.html#cb366-1" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">=</span> FeatureImp<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="at">loss =</span> <span class="st">&quot;mae&quot;</span>)</span>
<span id="cb366-2"><a href="interpretation-and-causality-with-machine-learning.html#cb366-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imp)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-175-1.png" width="672" /></p>
</div>
<div id="partial-dependencies" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Partial dependencies</h3>
<p>Partial dependencies are similar to allEffects plots for normal regressions, the idea is to visualize “marginal effects” of predictors (with the feature argument we specify the variable we want to visualize):</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="interpretation-and-causality-with-machine-learning.html#cb367-1" aria-hidden="true" tabindex="-1"></a>eff <span class="ot">=</span> FeatureEffect<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="at">feature =</span> <span class="st">&quot;rm&quot;</span>, <span class="at">method =</span> <span class="st">&quot;pdp&quot;</span>, <span class="at">grid.size =</span> <span class="dv">30</span>)</span>
<span id="cb367-2"><a href="interpretation-and-causality-with-machine-learning.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(eff)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-176-1.png" width="672" /></p>
<p>Partial dependencies can be also plotted for single observations:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="interpretation-and-causality-with-machine-learning.html#cb368-1" aria-hidden="true" tabindex="-1"></a>eff <span class="ot">=</span> FeatureEffect<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="at">feature =</span> <span class="st">&quot;rm&quot;</span>, <span class="at">method =</span> <span class="st">&quot;pdp+ice&quot;</span>, <span class="at">grid.size =</span> <span class="dv">30</span>)</span>
<span id="cb368-2"><a href="interpretation-and-causality-with-machine-learning.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(eff)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
<p>One disadvantage of partial dependencies is that they are sensitive to correlated predictors. Accumulated local effects can be used to account for correlation for predictors</p>
</div>
<div id="accumulated-local-effects" class="section level3" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Accumulated local effects</h3>
<p>Accumulated local effects (ALE) are basically partial dependencies plots but try to correct for correlations between predictors</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="interpretation-and-causality-with-machine-learning.html#cb369-1" aria-hidden="true" tabindex="-1"></a>ale <span class="ot">=</span> FeatureEffect<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="at">feature =</span> <span class="st">&quot;rm&quot;</span>, <span class="at">method =</span> <span class="st">&quot;ale&quot;</span>)</span>
<span id="cb369-2"><a href="interpretation-and-causality-with-machine-learning.html#cb369-2" aria-hidden="true" tabindex="-1"></a>ale<span class="sc">$</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-178-1.png" width="672" /></p>
<p>If there is no colinearity, you shouldn’t see much difference between partial dependencies and ALE plots.</p>
</div>
<div id="friedmans-h-statistic" class="section level3" number="5.1.5">
<h3><span class="header-section-number">5.1.5</span> Friedmans H-statistic</h3>
<p>The H-statistic can be used to find interactions between predictors. However, again, keep in mind that the H-statistic is sensible to correlation between predictors:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="interpretation-and-causality-with-machine-learning.html#cb370-1" aria-hidden="true" tabindex="-1"></a>interact <span class="ot">=</span> Interaction<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="st">&quot;lstat&quot;</span>)</span>
<span id="cb370-2"><a href="interpretation-and-causality-with-machine-learning.html#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(interact)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-179-1.png" width="672" /></p>
</div>
<div id="global-explainer---simplifying-the-ml-model" class="section level3" number="5.1.6">
<h3><span class="header-section-number">5.1.6</span> Global explainer - Simplifying the ML model</h3>
<p>Another idea is to simplify the ML model with another simpler model such as a decision tree. We create predictions with the ML model for a lot of different input values and then we fit on these predictions a decision tree, which we can then interpret.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="interpretation-and-causality-with-machine-learning.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(partykit)</span></code></pre></div>
<pre><code>## Loading required package: libcoin</code></pre>
<pre><code>## Loading required package: mvtnorm</code></pre>
<pre><code>## 
## Attaching package: &#39;mvtnorm&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:mclust&#39;:
## 
##     dmvnorm</code></pre>
<pre><code>## 
## Attaching package: &#39;partykit&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:BiocGenerics&#39;:
## 
##     width</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="interpretation-and-causality-with-machine-learning.html#cb378-1" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">=</span> TreeSurrogate<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="at">maxdepth =</span> <span class="dv">2</span>)</span>
<span id="cb378-2"><a href="interpretation-and-causality-with-machine-learning.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-180-1.png" width="672" /></p>
</div>
<div id="local-explainer---lime-explaining-single-instances-observations" class="section level3" number="5.1.7">
<h3><span class="header-section-number">5.1.7</span> Local explainer - LIME explaining single instances (observations)</h3>
<p>The global approach is to simplify the entire ML-black-box model via a simpler model, which is then interpretable.</p>
<p>However, sometimes we are only interested in understanding how single observations/predictions are generated. The lime approach explores the feature space around one observations and based on this local spare fits then a simpler model (e.g. a linear model):</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="interpretation-and-causality-with-machine-learning.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code></pre></div>
<pre><code>## Loaded glmnet 4.1-1</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="interpretation-and-causality-with-machine-learning.html#cb381-1" aria-hidden="true" tabindex="-1"></a>lime.explain <span class="ot">=</span> LocalModel<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="at">x.interest =</span> X[<span class="dv">1</span>,])</span></code></pre></div>
<pre><code>## Loading required package: gower</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="interpretation-and-causality-with-machine-learning.html#cb383-1" aria-hidden="true" tabindex="-1"></a>lime.explain<span class="sc">$</span>results</span></code></pre></div>
<pre><code>##               beta x.recoded    effect x.original feature feature.value
## rm       4.1893817     6.575 27.545185      6.575      rm      rm=6.575
## ptratio -0.5307031    15.300 -8.119758       15.3 ptratio  ptratio=15.3
## lstat   -0.4398104     4.980 -2.190256       4.98   lstat    lstat=4.98</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="interpretation-and-causality-with-machine-learning.html#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lime.explain)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-181-1.png" width="672" /></p>
</div>
<div id="local-explainer---shapley" class="section level3" number="5.1.8">
<h3><span class="header-section-number">5.1.8</span> Local explainer - Shapley</h3>
<p>The Shapley method computes the so called Shapley value, feature contributions for single predictions, and is based on an approach from cooperative game theory. The idea is that each feature value of the instance is a “player” in a game, where the prediction is the reward. The Shapley value tells us how to fairly distribute the award among the feature.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="interpretation-and-causality-with-machine-learning.html#cb386-1" aria-hidden="true" tabindex="-1"></a>shapley <span class="ot">=</span> Shapley<span class="sc">$</span><span class="fu">new</span>(predictor, <span class="at">x.interest =</span> X[<span class="dv">1</span>,])</span>
<span id="cb386-2"><a href="interpretation-and-causality-with-machine-learning.html#cb386-2" aria-hidden="true" tabindex="-1"></a>shapley<span class="sc">$</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-182-1.png" width="672" /></p>
</div>
</div>
<div id="causal-inference-and-machine-learning" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Causal inference and machine learning</h2>
<p>xAI aims at explaining how predictions are being made. In general, xAI != causality. xAI methods measure which variables are used by the algorithm for predictions, or how much variables improve predictions. The important point to note here: if a variable causes something, we could also expect that it helps to predict the very thing. The opposite, however, is not generally true - it is very often possible that a variable that doesn’t cause something can predict something.</p>
<p>In statistical courses (in particular course: advanced biostatistics), we discuss the issue of causality at length. Here, we don’t want to go into the details, but again, you should in general resist to interpret indicators of importance in xAI as causal effects. They tell you something about what’s going on in the algorithm, not about what’s going on in reality.</p>
<div id="causal-inference-on-static-data" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Causal inference on static data</h3>
<p>Methods for causal inference depend on whether we have dynamic or static data. The latter is the more common case. With static data, the problem is confounding - if you have several predictors that are correlated, you can get spurious correlations between a given predictor and the response, although there are no in general.</p>
<p>A multiple regression, and a few other methods are able to correct for other predictors, and thus isolate the causal effect. The same is not necessarily true for ML algorithms and xAI methods. This is not a bug, but a feature - for making good predictions, it is often no problem, but rather an advantage to also use non-causal predictors.</p>
<p>Here an example for the variable importance indicators in the RF algorithm. The purpose of this script is to show that RF variable importance will split importance values for collinear variables evenly, even if collinearity is low enough so that variables are separable and would be correctly separated by an lm / ANOVA</p>
<p>We first simulate a dataset with 2 predictors that are strongly correlated, but only one of them has an effect on the response.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="interpretation-and-causality-with-machine-learning.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation parameters</span></span>
<span id="cb387-2"><a href="interpretation-and-causality-with-machine-learning.html#cb387-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb387-3"><a href="interpretation-and-causality-with-machine-learning.html#cb387-3" aria-hidden="true" tabindex="-1"></a>col <span class="ot">=</span> <span class="fl">0.7</span></span>
<span id="cb387-4"><a href="interpretation-and-causality-with-machine-learning.html#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create collinear predictors</span></span>
<span id="cb387-5"><a href="interpretation-and-causality-with-machine-learning.html#cb387-5" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> <span class="fu">runif</span>(n)</span>
<span id="cb387-6"><a href="interpretation-and-causality-with-machine-learning.html#cb387-6" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> col <span class="sc">*</span> x1 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>col) <span class="sc">*</span> <span class="fu">runif</span>(n)</span>
<span id="cb387-7"><a href="interpretation-and-causality-with-machine-learning.html#cb387-7" aria-hidden="true" tabindex="-1"></a><span class="co"># response is only influenced by x1</span></span>
<span id="cb387-8"><a href="interpretation-and-causality-with-machine-learning.html#cb387-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span></code></pre></div>
<p>lm / anova correctly identify x1 as causal variable</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="interpretation-and-causality-with-machine-learning.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2))</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##            Df Sum Sq Mean Sq  F value Pr(&gt;F)    
## x1          1 106.30 106.300 110.1988 &lt;2e-16 ***
## x2          1   0.23   0.228   0.2368 0.6267    
## Residuals 997 961.73   0.965                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Fit RF and show variable importance</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="interpretation-and-causality-with-machine-learning.html#cb390-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">importance=</span><span class="cn">TRUE</span>)</span>
<span id="cb390-2"><a href="interpretation-and-causality-with-machine-learning.html#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(fit)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-185-1.png" width="672" />
Variable importance is now split nearly evenly.</p>
<p>Task: understand why this is - remember:</p>
<ul>
<li>How the random forest works - variables are randomly hidden from the regression tree when the trees for the forest are built</li>
<li>Remember that as x1 ~ x2, we can use x2 as a replacement for x1</li>
<li>Remember that the variable importance measures the average contributions of the different variables in the trees of the forest</li>
</ul>
</div>
<div id="structural-equation-models" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Structural equation models</h3>
<p>If causal relationships get more complicated, it will not be possible to adjust correctly with a simple lm. In this case, in statistics, we will usually use structural equation models (SEMs). SEMs are designed to estimate entire causal diagrams. There are two main SEM packages in R: for anything that is non-normal, you will currently have to estimate the DAG piece-wise with CRAN package piecewiseSEM. Example for a vegetation dataset:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="interpretation-and-causality-with-machine-learning.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(piecewiseSEM)</span></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;lme4&#39;:
##   method                          from
##   cooks.distance.influence.merMod car 
##   influence.merMod                car 
##   dfbeta.influence.merMod         car 
##   dfbetas.influence.merMod        car</code></pre>
<pre><code>## 
##   This is piecewiseSEM version 2.0.2
## 
##   If you have used the package before, it is strongly recommended you read Section 3 of the vignette(&#39;piecewiseSEM&#39;) to familiarize yourself with the new syntax
## 
##   Questions or bugs can be addressed to &lt;jlefcheck@bigelow.org&gt;</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="interpretation-and-causality-with-machine-learning.html#cb394-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">psem</span>(</span>
<span id="cb394-2"><a href="interpretation-and-causality-with-machine-learning.html#cb394-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">lm</span>(rich <span class="sc">~</span> distance <span class="sc">+</span> elev <span class="sc">+</span> abiotic <span class="sc">+</span> age <span class="sc">+</span> hetero <span class="sc">+</span> firesev <span class="sc">+</span> cover, <span class="at">data =</span> keeley),</span>
<span id="cb394-3"><a href="interpretation-and-causality-with-machine-learning.html#cb394-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">lm</span>(firesev <span class="sc">~</span> elev <span class="sc">+</span> age <span class="sc">+</span> cover, <span class="at">data =</span> keeley),</span>
<span id="cb394-4"><a href="interpretation-and-causality-with-machine-learning.html#cb394-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">lm</span>(cover <span class="sc">~</span> age <span class="sc">+</span> elev <span class="sc">+</span> hetero <span class="sc">+</span> abiotic, <span class="at">data =</span> keeley)</span>
<span id="cb394-5"><a href="interpretation-and-causality-with-machine-learning.html#cb394-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb394-6"><a href="interpretation-and-causality-with-machine-learning.html#cb394-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
  |                                                                                                                                                   
  |                                                                                                                                             |   0%
  |                                                                                                                                                   
  |===================================                                                                                                          |  25%
  |                                                                                                                                                   
  |======================================================================                                                                       |  50%
  |                                                                                                                                                   
  |==========================================================================================================                                   |  75%
  |                                                                                                                                                   
  |=============================================================================================================================================| 100%</code></pre>
<pre><code>## 
## Structural Equation Model of mod 
## 
## Call:
##   rich ~ distance + elev + abiotic + age + hetero + firesev + cover
##   firesev ~ elev + age + cover
##   cover ~ age + elev + hetero + abiotic
## 
##     AIC      BIC
##  46.543   96.539
## 
## ---
## Tests of directed separation:
## 
##               Independ.Claim Estimate Std.Error DF Crit.Value P.Value 
##     cover  ~  distance + ...   0.0021    0.0050 84     0.4201  0.6755 
##   firesev  ~  distance + ...  -0.0194    0.0234 85    -0.8264  0.4109 
##    firesev  ~  abiotic + ...  -0.0245    0.0208 85    -1.1799  0.2413 
##     firesev  ~  hetero + ...  -0.8093    1.4061 85    -0.5755  0.5665 
## 
## Global goodness-of-fit:
## 
##   Fisher&#39;s C = 6.543 with P-value = 0.587 and on 8 degrees of freedom
## 
## ---
## Coefficients:
## 
##   Response Predictor Estimate Std.Error DF Crit.Value P.Value Std.Estimate    
##       rich  distance   0.6157    0.1855 82     3.3195  0.0013       0.3599  **
##       rich      elev  -0.0092    0.0059 82    -1.5663  0.1211      -0.1569    
##       rich   abiotic   0.4881    0.1641 82     2.9741  0.0039       0.2482  **
##       rich       age   0.0241    0.1097 82     0.2199  0.8265       0.0201    
##       rich    hetero  44.4135   10.8093 82     4.1088  0.0001       0.3376 ***
##       rich   firesev  -1.0181    0.8031 82    -1.2677  0.2085      -0.1114    
##       rich     cover  12.3998    4.2206 82     2.9379  0.0043       0.2604  **
##    firesev      elev  -0.0006    0.0006 86    -0.9298  0.3551      -0.0874    
##    firesev       age   0.0473    0.0129 86     3.6722  0.0004       0.3597 ***
##    firesev     cover  -1.5214    0.5204 86    -2.9236  0.0044      -0.2921  **
##      cover       age  -0.0101    0.0024 85    -4.1757  0.0001      -0.3991 ***
##      cover      elev   0.0004    0.0001 85     2.9688  0.0039       0.2999  **
##      cover    hetero  -0.7875    0.2719 85    -2.8960  0.0048      -0.2850  **
##      cover   abiotic   0.0021    0.0042 85     0.4855  0.6286       0.0498    
## 
##   Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05
## 
## Individual R-squared:
## 
##   Response method R.squared
##       rich   none      0.57
##    firesev   none      0.30
##      cover   none      0.26</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="interpretation-and-causality-with-machine-learning.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(mod)</span></span></code></pre></div>
<p>For linear SEMs, we can estimate the entire DAG in one go. This also allows to have unobserved variables in the DAG. One of the most popular packages for this is lavaan</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="interpretation-and-causality-with-machine-learning.html#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span></code></pre></div>
<pre><code>## This is lavaan 0.6-8
## lavaan is FREE software! Please report any bugs.</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="interpretation-and-causality-with-machine-learning.html#cb400-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb400-2"><a href="interpretation-and-causality-with-machine-learning.html#cb400-2" aria-hidden="true" tabindex="-1"></a><span class="st"> rich ~ distance + elev + abiotic + age + hetero + firesev + cover</span></span>
<span id="cb400-3"><a href="interpretation-and-causality-with-machine-learning.html#cb400-3" aria-hidden="true" tabindex="-1"></a><span class="st"> firesev ~ elev + age + cover</span></span>
<span id="cb400-4"><a href="interpretation-and-causality-with-machine-learning.html#cb400-4" aria-hidden="true" tabindex="-1"></a><span class="st"> cover ~ age + elev + abiotic</span></span>
<span id="cb400-5"><a href="interpretation-and-causality-with-machine-learning.html#cb400-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb400-6"><a href="interpretation-and-causality-with-machine-learning.html#cb400-6" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(mod,<span class="at">data=</span>keeley)</span></code></pre></div>
<pre><code>## Warning in lav_data_full(data = data, group = group, cluster = cluster, : lavaan WARNING: some observed variances are (at least) a factor 1000 times
## larger than others; use varTable(fit) to investigate</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="interpretation-and-causality-with-machine-learning.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## lavaan 0.6-8 ended normally after 77 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                        16
##                                                       
##   Number of observations                            90
##                                                       
## Model Test User Model:
##                                                       
##   Test statistic                                10.437
##   Degrees of freedom                                 5
##   P-value (Chi-square)                           0.064
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate   Std.Err  z-value  P(&gt;|z|)
##   rich ~                                               
##     distance           0.616    0.177    3.485    0.000
##     elev              -0.009    0.006   -1.644    0.100
##     abiotic            0.488    0.156    3.134    0.002
##     age                0.024    0.105    0.229    0.819
##     hetero            44.414    9.831    4.517    0.000
##     firesev           -1.018    0.759   -1.341    0.180
##     cover             12.400    3.841    3.228    0.001
##   firesev ~                                            
##     elev              -0.001    0.001   -0.951    0.342
##     age                0.047    0.013    3.757    0.000
##     cover             -1.521    0.509   -2.991    0.003
##   cover ~                                              
##     age               -0.009    0.002   -3.875    0.000
##     elev               0.000    0.000    2.520    0.012
##     abiotic           -0.000    0.004   -0.115    0.909
## 
## Variances:
##                    Estimate   Std.Err  z-value  P(&gt;|z|)
##    .rich              97.844   14.586    6.708    0.000
##    .firesev            1.887    0.281    6.708    0.000
##    .cover              0.081    0.012    6.708    0.000</code></pre>
<p>The default Plot options are not so nice as before</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="interpretation-and-causality-with-machine-learning.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_version(&quot;lavaanPlot&quot;, version = &quot;0.6.0&quot;)</span></span>
<span id="cb404-2"><a href="interpretation-and-causality-with-machine-learning.html#cb404-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaanPlot)</span>
<span id="cb404-3"><a href="interpretation-and-causality-with-machine-learning.html#cb404-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lavaanPlot</span>(<span class="at">model =</span> fit)</span></code></pre></div>
<div id="htmlwidget-edacf4e3cb161e83fe88" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-edacf4e3cb161e83fe88">{"x":{"diagram":" digraph plot { \n graph [ overlap = true, fontsize = 10 ] \n node [ shape = box ] \n node [shape = box] \n distance; elev; abiotic; age; hetero; firesev; cover; rich \n node [shape = oval] \n  \n \n edge [ color = black ] \n distance->rich elev->rich abiotic->rich age->rich hetero->rich firesev->rich cover->rich elev->firesev age->firesev cover->firesev age->cover elev->cover abiotic->cover  \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Another plotting option is to use semPlot</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="interpretation-and-causality-with-machine-learning.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(semPlot)</span>
<span id="cb405-2"><a href="interpretation-and-causality-with-machine-learning.html#cb405-2" aria-hidden="true" tabindex="-1"></a><span class="fu">semPaths</span>(fit)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-189-1.png" width="672" /></p>
</div>
<div id="automatic-causal-discovery" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Automatic causal discovery</h3>
<p>But how to get the causal graph? In statistics, it is common to “guess” it and afterwards do residual checks, in the same way as we guess the structure of a regression. For more complicated problems, however, this is unsatisfying. Some groups therefore work on so-called causal discovery algorithms, i.e. algorithms that automatically generate causal graphs from data. One of the most classic algorithms of this sort is the PC algorithm. Here an example using the pcalg package:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="interpretation-and-causality-with-machine-learning.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bioconductor dependencies have to installed by hand, e.g. </span></span>
<span id="cb406-2"><a href="interpretation-and-causality-with-machine-learning.html#cb406-2" aria-hidden="true" tabindex="-1"></a><span class="co"># BiocManager::install(c(&quot;Rgraphviz&quot;, &quot;graph&quot;, &quot;RBGL&quot;)</span></span>
<span id="cb406-3"><a href="interpretation-and-causality-with-machine-learning.html#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pcalg)</span></code></pre></div>
<p>Loading the data</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="interpretation-and-causality-with-machine-learning.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;gmG&quot;</span>, <span class="at">package =</span> <span class="st">&quot;pcalg&quot;</span>) <span class="do">## loads data sets gmG and gmG8</span></span>
<span id="cb407-2"><a href="interpretation-and-causality-with-machine-learning.html#cb407-2" aria-hidden="true" tabindex="-1"></a>suffStat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">C =</span> <span class="fu">cor</span>(gmG8<span class="sc">$</span>x), <span class="at">n =</span> <span class="fu">nrow</span>(gmG8<span class="sc">$</span>x))</span>
<span id="cb407-3"><a href="interpretation-and-causality-with-machine-learning.html#cb407-3" aria-hidden="true" tabindex="-1"></a>varNames <span class="ot">&lt;-</span> gmG8<span class="sc">$</span>g<span class="sc">@</span>nodes</span></code></pre></div>
<p>First, the skeleton algorithm creates a basic graph without connections (a skeleton of the graph)</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="interpretation-and-causality-with-machine-learning.html#cb408-1" aria-hidden="true" tabindex="-1"></a>skel.gmG8 <span class="ot">&lt;-</span> <span class="fu">skeleton</span>(suffStat, <span class="at">indepTest =</span> gaussCItest,</span>
<span id="cb408-2"><a href="interpretation-and-causality-with-machine-learning.html#cb408-2" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> varNames, <span class="at">alpha =</span> <span class="fl">0.01</span>)</span>
<span id="cb408-3"><a href="interpretation-and-causality-with-machine-learning.html#cb408-3" aria-hidden="true" tabindex="-1"></a>Rgraphviz<span class="sc">::</span><span class="fu">plot</span>(skel.gmG8)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-192-1.png" width="672" /></p>
<p>What is missing here is the direction of the errors. The PC algorithm now makes tests for conditional independence, which allows fixing a part (but typically not all) of the directions of the causal arrows.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="interpretation-and-causality-with-machine-learning.html#cb409-1" aria-hidden="true" tabindex="-1"></a>pc.gmG8 <span class="ot">&lt;-</span> <span class="fu">pc</span>(suffStat, <span class="at">indepTest =</span> gaussCItest,</span>
<span id="cb409-2"><a href="interpretation-and-causality-with-machine-learning.html#cb409-2" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> varNames, <span class="at">alpha =</span> <span class="fl">0.01</span>)</span>
<span id="cb409-3"><a href="interpretation-and-causality-with-machine-learning.html#cb409-3" aria-hidden="true" tabindex="-1"></a>Rgraphviz<span class="sc">::</span><span class="fu">plot</span>(pc.gmG8 )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
</div>
<div id="causal-inference-on-dynamic-data" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Causal inference on dynamic data</h3>
<p>When working with dynamic data, we can use an additional piece of information - the effect usually precedes the cause, which means that we can test for a time-lag between cause and effect to determine the direction of causality. This way of testing for causality is known as Granger causality, or Granger methods. Here an example:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="interpretation-and-causality-with-machine-learning.html#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code></pre></div>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: &#39;lmtest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:crayon&#39;:
## 
##     reset</code></pre>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="interpretation-and-causality-with-machine-learning.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Which came first: the chicken or the egg?</span></span>
<span id="cb416-2"><a href="interpretation-and-causality-with-machine-learning.html#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ChickEgg)</span>
<span id="cb416-3"><a href="interpretation-and-causality-with-machine-learning.html#cb416-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grangertest</span>(egg <span class="sc">~</span> chicken, <span class="at">order =</span> <span class="dv">3</span>, <span class="at">data =</span> ChickEgg)</span></code></pre></div>
<pre><code>## Granger causality test
## 
## Model 1: egg ~ Lags(egg, 1:3) + Lags(chicken, 1:3)
## Model 2: egg ~ Lags(egg, 1:3)
##   Res.Df Df      F Pr(&gt;F)
## 1     44                 
## 2     47 -3 0.5916 0.6238</code></pre>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="interpretation-and-causality-with-machine-learning.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grangertest</span>(chicken <span class="sc">~</span> egg, <span class="at">order =</span> <span class="dv">3</span>, <span class="at">data =</span> ChickEgg)</span></code></pre></div>
<pre><code>## Granger causality test
## 
## Model 1: chicken ~ Lags(chicken, 1:3) + Lags(egg, 1:3)
## Model 2: chicken ~ Lags(chicken, 1:3)
##   Res.Df Df     F   Pr(&gt;F)   
## 1     44                     
## 2     47 -3 5.405 0.002966 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="outlook-for-machine-learning" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Outlook for machine learning</h3>
<p>As we have seen, there are already a few methods / algorithms to discover causality from large data, but the systematic transfer of these concepts to machine learning, in particular deep learning, is still at its infancy. At the moment, this field is actively researched and changes extremely fast, so we recommend to use google to see what is currently going on. Particular, in business and industry, there is a large interest in learning about causal effect from large datasets. In our opinion, a great topic for young scientists to specialize on.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Deep.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generative-modeling-and-reinforcement-learning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
