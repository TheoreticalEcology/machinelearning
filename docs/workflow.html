<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Machine Learning workflow | Machine Learning and AI in TensorFlow and R</title>
<meta name="author" content="Maximilian Pichler and Florian Hartig">
<meta name="description" content="6.1 The Standard Machine Learning Pipeline at the Eexample of the Titanic Data set Before we specialize on any tuning, it is important to understand that machine learning always consists of a...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 6 Machine Learning workflow | Machine Learning and AI in TensorFlow and R">
<meta property="og:type" content="book">
<meta property="og:description" content="6.1 The Standard Machine Learning Pipeline at the Eexample of the Titanic Data set Before we specialize on any tuning, it is important to understand that machine learning always consists of a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Machine Learning workflow | Machine Learning and AI in TensorFlow and R">
<meta name="twitter:description" content="6.1 The Standard Machine Learning Pipeline at the Eexample of the Titanic Data set Before we specialize on any tuning, it is important to understand that machine learning always consists of a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="libs/panelset-0.2.6/panelset.js"></script><style>
    #content {
        font-size: 0.95rem;
    }


    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="panel.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Machine Learning and AI in TensorFlow and R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Prerequisites</a></li>
<li><a class="" href="reminder.html"><span class="header-section-number">2</span> Reminders About Basic Operations in R</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">3</span> Introduction to Machine Learning</a></li>
<li><a class="" href="tensorflowintro.html"><span class="header-section-number">4</span> Introduction to TensorFlow, Keras, and Torch</a></li>
<li><a class="" href="fundamental.html"><span class="header-section-number">5</span> Common Machine Learning algorithms</a></li>
<li><a class="active" href="workflow.html"><span class="header-section-number">6</span> Machine Learning workflow</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/TheoreticalEcology/machinelearning">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="workflow" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Machine Learning workflow<a class="anchor" aria-label="anchor" href="#workflow"><i class="fas fa-link"></i></a>
</h1>
<!-- Put this here (right after the first markdown headline) and only here for each document! -->
<script src="./scripts/multipleChoice.js"></script><div id="the-standard-machine-learning-pipeline-at-the-eexample-of-the-titanic-data-set" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> The Standard Machine Learning Pipeline at the Eexample of the Titanic Data set<a class="anchor" aria-label="anchor" href="#the-standard-machine-learning-pipeline-at-the-eexample-of-the-titanic-data-set"><i class="fas fa-link"></i></a>
</h2>
<p>Before we specialize on any tuning, it is important to understand that machine learning always consists of a pipeline of actions.</p>
<p>The typical machine learning workflow consist of:</p>
<ul>
<li>Data cleaning and exploration (EDA = explorative data analysis) for example with tidyverse.</li>
<li>Preprocessing and feature selection.</li>
<li>Splitting data set into training and test set for evaluation.</li>
<li>Model fitting.</li>
<li>Model evaluation.</li>
<li>New predictions.</li>
</ul>
<p>Here is an (optional) video that explains the entire pipeline from a slightly different perspective:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/nKW8Ndu7Mjw" frameborder="0" allow="accelerometer; autoplay; encrypted-media;
  gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>In the following example, we use tidyverse, a collection of R packages for data science / data manipulation mainly developed by Hadley Wickham. A video that explains the basics can be found here :</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/nRtp7wSEtJA" frameborder="0" allow="accelerometer; autoplay; encrypted-media;
  gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Another good reference is “<strong>R for data science</strong>” by Hadley Wickham: <a href="https://r4ds.had.co.nz/" target="_blank" rel="noopener"></a>.</p>
<p>For this lecture you need the Titanic data set provided by us. You can find it in GRIPS (datasets.RData in the data set and submission section) or at <a href="http://rhsbio6.uni-regensburg.de:8500" target="_blank" rel="noopener">http://rhsbio6.uni-regensburg.de:8500</a>.</p>
<p>We have split the data set already into training and test/prediction data sets (the test/prediction split has one column less than the train split, as the result is not known a priori).</p>
<div id="data-cleaning" class="section level3" number="6.1.1">
<h3>
<span class="header-section-number">6.1.1</span> Data Cleaning<a class="anchor" aria-label="anchor" href="#data-cleaning"><i class="fas fa-link"></i></a>
</h3>
<p>Load necessary libraries:</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com">keras</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/tensorflow">tensorflow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/set_random_seed.html">set_random_seed</a></span><span class="op">(</span><span class="fl">321L</span>, disable_gpu <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># Already sets R's random seed.</span></span></code></pre></div>
<p>Load data set:</p>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TheoreticalEcology/">EcoData</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">titanic_ml</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">titanic_ml</span></span></code></pre></div>
<p>Standard summaries:</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1309 obs. of  14 variables:</span></span>
<span><span class="co">#&gt;  $ pclass   : int  2 1 3 3 3 3 3 1 3 1 ...</span></span>
<span><span class="co">#&gt;  $ survived : int  1 1 0 0 0 0 0 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ name     : chr  "Sinkkonen, Miss. Anna" "Woolner, Mr. Hugh" "Sage, Mr. Douglas Bullen" "Palsson, Master. Paul Folke" ...</span></span>
<span><span class="co">#&gt;  $ sex      : Factor w/ 2 levels "female","male": 1 2 2 2 2 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ age      : num  30 NA NA 6 30.5 38.5 20 53 NA 42 ...</span></span>
<span><span class="co">#&gt;  $ sibsp    : int  0 0 8 3 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ parch    : int  0 0 2 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ ticket   : Factor w/ 929 levels "110152","110413",..: 221 123 779 542 589 873 472 823 588 834 ...</span></span>
<span><span class="co">#&gt;  $ fare     : num  13 35.5 69.55 21.07 8.05 ...</span></span>
<span><span class="co">#&gt;  $ cabin    : Factor w/ 187 levels "","A10","A11",..: 1 94 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ embarked : Factor w/ 4 levels "","C","Q","S": 4 4 4 4 4 4 4 2 4 2 ...</span></span>
<span><span class="co">#&gt;  $ boat     : Factor w/ 28 levels "","1","10","11",..: 3 28 1 1 1 1 1 19 1 15 ...</span></span>
<span><span class="co">#&gt;  $ body     : int  NA NA NA NA 50 32 NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ home.dest: Factor w/ 370 levels "","?Havana, Cuba",..: 121 213 1 1 1 1 322 350 1 1 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;      pclass         survived          name               sex           age         </span></span>
<span><span class="co">#&gt;  Min.   :1.000   Min.   :0.0000   Length:1309        female:466   Min.   : 0.1667  </span></span>
<span><span class="co">#&gt;  1st Qu.:2.000   1st Qu.:0.0000   Class :character   male  :843   1st Qu.:21.0000  </span></span>
<span><span class="co">#&gt;  Median :3.000   Median :0.0000   Mode  :character                Median :28.0000  </span></span>
<span><span class="co">#&gt;  Mean   :2.295   Mean   :0.3853                                   Mean   :29.8811  </span></span>
<span><span class="co">#&gt;  3rd Qu.:3.000   3rd Qu.:1.0000                                   3rd Qu.:39.0000  </span></span>
<span><span class="co">#&gt;  Max.   :3.000   Max.   :1.0000                                   Max.   :80.0000  </span></span>
<span><span class="co">#&gt;                  NA's   :655                                      NA's   :263      </span></span>
<span><span class="co">#&gt;      sibsp            parch            ticket          fare        </span></span>
<span><span class="co">#&gt;  Min.   :0.0000   Min.   :0.000   CA. 2343:  11   Min.   :  0.000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0000   1st Qu.:0.000   1601    :   8   1st Qu.:  7.896  </span></span>
<span><span class="co">#&gt;  Median :0.0000   Median :0.000   CA 2144 :   8   Median : 14.454  </span></span>
<span><span class="co">#&gt;  Mean   :0.4989   Mean   :0.385   3101295 :   7   Mean   : 33.295  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0000   3rd Qu.:0.000   347077  :   7   3rd Qu.: 31.275  </span></span>
<span><span class="co">#&gt;  Max.   :8.0000   Max.   :9.000   347082  :   7   Max.   :512.329  </span></span>
<span><span class="co">#&gt;                                   (Other) :1261   NA's   :1        </span></span>
<span><span class="co">#&gt;              cabin      embarked      boat          body                      home.dest  </span></span>
<span><span class="co">#&gt;                 :1014    :  2           :823   Min.   :  1.0                       :564  </span></span>
<span><span class="co">#&gt;  C23 C25 C27    :   6   C:270    13     : 39   1st Qu.: 72.0   New York, NY        : 64  </span></span>
<span><span class="co">#&gt;  B57 B59 B63 B66:   5   Q:123    C      : 38   Median :155.0   London              : 14  </span></span>
<span><span class="co">#&gt;  G6             :   5   S:914    15     : 37   Mean   :160.8   Montreal, PQ        : 10  </span></span>
<span><span class="co">#&gt;  B96 B98        :   4            14     : 33   3rd Qu.:256.0   Cornwall / Akron, OH:  9  </span></span>
<span><span class="co">#&gt;  C22 C26        :   4            4      : 31   Max.   :328.0   Paris, France       :  9  </span></span>
<span><span class="co">#&gt;  (Other)        : 271            (Other):308   NA's   :1188    (Other)             :639</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;      pclass survived                         name    sex  age sibsp parch</span></span>
<span><span class="co">#&gt; 561       2        1        Sinkkonen, Miss. Anna female 30.0     0     0</span></span>
<span><span class="co">#&gt; 321       1        1            Woolner, Mr. Hugh   male   NA     0     0</span></span>
<span><span class="co">#&gt; 1177      3        0     Sage, Mr. Douglas Bullen   male   NA     8     2</span></span>
<span><span class="co">#&gt; 1098      3        0  Palsson, Master. Paul Folke   male  6.0     3     1</span></span>
<span><span class="co">#&gt; 1252      3        0   Tomlin, Mr. Ernest Portage   male 30.5     0     0</span></span>
<span><span class="co">#&gt; 1170      3        0 Saether, Mr. Simon Sivertsen   male 38.5     0     0</span></span>
<span><span class="co">#&gt;                  ticket   fare cabin embarked boat body                home.dest</span></span>
<span><span class="co">#&gt; 561              250648 13.000              S   10   NA Finland / Washington, DC</span></span>
<span><span class="co">#&gt; 321               19947 35.500   C52        S    D   NA          London, England</span></span>
<span><span class="co">#&gt; 1177           CA. 2343 69.550              S        NA                         </span></span>
<span><span class="co">#&gt; 1098             349909 21.075              S        NA                         </span></span>
<span><span class="co">#&gt; 1252             364499  8.050              S        50                         </span></span>
<span><span class="co">#&gt; 1170 SOTON/O.Q. 3101262  7.250              S        32</span></span></code></pre></div>
<p>The name variable consists of 1309 unique factors (there are 1309 observations…):</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1307</span></span></code></pre></div>
<p>However, there is a title in each name. Let’s extract the titles:</p>
<ol style="list-style-type: decimal">
<li>We will extract all names and split each name after each comma “,”</li>
<li>We will split the second split of the name after a point “.” and extract the titles.</li>
</ol>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_split</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">name</span>,</span>
<span>                     <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">x</span>, pattern <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">titles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">first_split</span>,</span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"."</span>,fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>We get 18 unique titles:</p>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">titles</span><span class="op">)</span></span>
<span><span class="co">#&gt; titles</span></span>
<span><span class="co">#&gt;          Capt           Col           Don          Dona            Dr      Jonkheer </span></span>
<span><span class="co">#&gt;             1             4             1             1             8             1 </span></span>
<span><span class="co">#&gt;          Lady         Major        Master          Miss          Mlle           Mme </span></span>
<span><span class="co">#&gt;             1             2            61           260             2             1 </span></span>
<span><span class="co">#&gt;            Mr           Mrs            Ms           Rev           Sir  the Countess </span></span>
<span><span class="co">#&gt;           757           197             2             8             1             1</span></span></code></pre></div>
<p>A few titles have a very low occurrence rate:</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titles</span> <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="op">(</span><span class="va">titles</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">titles</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_count.html">fct_count</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 18 × 2</span></span>
<span><span class="co">#&gt;    f                n</span></span>
<span><span class="co">#&gt;    &lt;fct&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 Capt             1</span></span>
<span><span class="co">#&gt;  2 Col              4</span></span>
<span><span class="co">#&gt;  3 Don              1</span></span>
<span><span class="co">#&gt;  4 Dona             1</span></span>
<span><span class="co">#&gt;  5 Dr               8</span></span>
<span><span class="co">#&gt;  6 Jonkheer         1</span></span>
<span><span class="co">#&gt;  7 Lady             1</span></span>
<span><span class="co">#&gt;  8 Major            2</span></span>
<span><span class="co">#&gt;  9 Master          61</span></span>
<span><span class="co">#&gt; 10 Miss           260</span></span>
<span><span class="co">#&gt; 11 Mlle             2</span></span>
<span><span class="co">#&gt; 12 Mme              1</span></span>
<span><span class="co">#&gt; 13 Mr             757</span></span>
<span><span class="co">#&gt; 14 Mrs            197</span></span>
<span><span class="co">#&gt; 15 Ms               2</span></span>
<span><span class="co">#&gt; 16 Rev              8</span></span>
<span><span class="co">#&gt; 17 Sir              1</span></span>
<span><span class="co">#&gt; 18 the Countess     1</span></span></code></pre></div>
<p>We will combine titles with low occurrences into one title, which we can easily do with the forcats package.</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titles2</span> <span class="op">=</span></span>
<span>  <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html">fct_collapse</a></span><span class="op">(</span><span class="va">titles</span>,</span>
<span>                        officer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Capt"</span>, <span class="st">"Col"</span>, <span class="st">"Major"</span>, <span class="st">"Dr"</span>, <span class="st">"Rev"</span><span class="op">)</span>,</span>
<span>                        royal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Jonkheer"</span>, <span class="st">"Don"</span>, <span class="st">"Sir"</span>,</span>
<span>                                  <span class="st">"the Countess"</span>, <span class="st">"Dona"</span>, <span class="st">"Lady"</span><span class="op">)</span>,</span>
<span>                        miss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Miss"</span>, <span class="st">"Mlle"</span><span class="op">)</span>,</span>
<span>                        mrs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mrs"</span>, <span class="st">"Mme"</span>, <span class="st">"Ms"</span><span class="op">)</span></span>
<span>                        <span class="op">)</span></span></code></pre></div>
<p>We can count titles again to see the new number of titles:</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titles2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>   <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_count.html">fct_count</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   f           n</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 officer    23</span></span>
<span><span class="co">#&gt; 2 royal       6</span></span>
<span><span class="co">#&gt; 3 Master     61</span></span>
<span><span class="co">#&gt; 4 miss      262</span></span>
<span><span class="co">#&gt; 5 mrs       200</span></span>
<span><span class="co">#&gt; 6 Mr        757</span></span></code></pre></div>
<p>Add new title variable to data set:</p>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">titles2</span><span class="op">)</span></span></code></pre></div>
<p>As a second example, we will explore and clean the numeric “age” variable.</p>
<p>Explore the variable:</p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;      pclass         survived          name               sex           age         </span></span>
<span><span class="co">#&gt;  Min.   :1.000   Min.   :0.0000   Length:1309        female:466   Min.   : 0.1667  </span></span>
<span><span class="co">#&gt;  1st Qu.:2.000   1st Qu.:0.0000   Class :character   male  :843   1st Qu.:21.0000  </span></span>
<span><span class="co">#&gt;  Median :3.000   Median :0.0000   Mode  :character                Median :28.0000  </span></span>
<span><span class="co">#&gt;  Mean   :2.295   Mean   :0.3853                                   Mean   :29.8811  </span></span>
<span><span class="co">#&gt;  3rd Qu.:3.000   3rd Qu.:1.0000                                   3rd Qu.:39.0000  </span></span>
<span><span class="co">#&gt;  Max.   :3.000   Max.   :1.0000                                   Max.   :80.0000  </span></span>
<span><span class="co">#&gt;                  NA's   :655                                      NA's   :263      </span></span>
<span><span class="co">#&gt;      sibsp            parch            ticket          fare        </span></span>
<span><span class="co">#&gt;  Min.   :0.0000   Min.   :0.000   CA. 2343:  11   Min.   :  0.000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0000   1st Qu.:0.000   1601    :   8   1st Qu.:  7.896  </span></span>
<span><span class="co">#&gt;  Median :0.0000   Median :0.000   CA 2144 :   8   Median : 14.454  </span></span>
<span><span class="co">#&gt;  Mean   :0.4989   Mean   :0.385   3101295 :   7   Mean   : 33.295  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1.0000   3rd Qu.:0.000   347077  :   7   3rd Qu.: 31.275  </span></span>
<span><span class="co">#&gt;  Max.   :8.0000   Max.   :9.000   347082  :   7   Max.   :512.329  </span></span>
<span><span class="co">#&gt;                                   (Other) :1261   NA's   :1        </span></span>
<span><span class="co">#&gt;              cabin      embarked      boat          body                      home.dest  </span></span>
<span><span class="co">#&gt;                 :1014    :  2           :823   Min.   :  1.0                       :564  </span></span>
<span><span class="co">#&gt;  C23 C25 C27    :   6   C:270    13     : 39   1st Qu.: 72.0   New York, NY        : 64  </span></span>
<span><span class="co">#&gt;  B57 B59 B63 B66:   5   Q:123    C      : 38   Median :155.0   London              : 14  </span></span>
<span><span class="co">#&gt;  G6             :   5   S:914    15     : 37   Mean   :160.8   Montreal, PQ        : 10  </span></span>
<span><span class="co">#&gt;  B96 B98        :   4            14     : 33   3rd Qu.:256.0   Cornwall / Akron, OH:  9  </span></span>
<span><span class="co">#&gt;  C22 C26        :   4            4      : 31   Max.   :328.0   Paris, France       :  9  </span></span>
<span><span class="co">#&gt;  (Other)        : 271            (Other):308   NA's   :1188    (Other)             :639  </span></span>
<span><span class="co">#&gt;      title    </span></span>
<span><span class="co">#&gt;  officer: 23  </span></span>
<span><span class="co">#&gt;  royal  :  6  </span></span>
<span><span class="co">#&gt;  Master : 61  </span></span>
<span><span class="co">#&gt;  miss   :262  </span></span>
<span><span class="co">#&gt;  mrs    :200  </span></span>
<span><span class="co">#&gt;  Mr     :757  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2009167</span></span></code></pre></div>
<p>20% NAs!
Either we remove all observations with NAs, or we impute (fill) the missing values, e.g. with the median age. However, age itself might depend on other variables such as sex, class and title. We want to fill the NAs with the median age of these groups.
In tidyverse we can easily “group” the data, i.e. we will nest the observations (here: group_by after sex, pclass and title).
After grouping, all operations (such as our median(age….)) will be done within the specified groups.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">pclass</span>, <span class="va">title</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fare2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fare</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">fare</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">fare</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="preprocessing-and-feature-selection" class="section level3" number="6.1.2">
<h3>
<span class="header-section-number">6.1.2</span> Preprocessing and Feature Selection<a class="anchor" aria-label="anchor" href="#preprocessing-and-feature-selection"><i class="fas fa-link"></i></a>
</h3>
<p>We want to use Keras in our example, but it cannot handle factors and requires the data to be scaled.</p>
<p>Normally, one would do this for all predictors, but as we only show the pipeline here, we have sub-selected a bunch of predictors and do this only for them.
We first scale the numeric predictors and change the factors with only two groups/levels into integers (this can be handled by Keras).</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_sub</span> <span class="op">=</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">survived</span>, <span class="va">sex</span>, <span class="va">age2</span>, <span class="va">fare2</span>, <span class="va">title</span>, <span class="va">pclass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age2 <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">age2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           fare2 <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">fare2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span>,</span>
<span>           title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span>, pclass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">pclass</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Factors with more than two levels should be <strong>one hot encoded</strong> (Make columns for every different factor level and write 1 in the respective column for every taken feature value and 0 else. For example: <span class="math inline">\(\{red, green, green, blue, red\} \rightarrow \{(0,0,1), (0,1,0), (0,1,0), (1,0,0), (0,0,1)\}\)</span>):</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_title</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/k_one_hot.html">k_one_hot</a></span><span class="op">(</span><span class="va">data_sub</span><span class="op">$</span><span class="va">title</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">title</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">one_title</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">title</span><span class="op">)</span></span>
<span></span>
<span><span class="va">one_sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/k_one_hot.html">k_one_hot</a></span><span class="op">(</span><span class="va">data_sub</span><span class="op">$</span><span class="va">sex</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">one_sex</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span></span>
<span><span class="va">one_pclass</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/k_one_hot.html">k_one_hot</a></span><span class="op">(</span><span class="va">data_sub</span><span class="op">$</span><span class="va">pclass</span>,  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">one_pclass</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span><span class="op">)</span><span class="op">)</span>, <span class="st">"pclass"</span><span class="op">)</span></span></code></pre></div>
<p>And we have to add the dummy encoded variables to the data set:</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_sub</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>survived<span class="op">=</span> <span class="va">data_sub</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span>,</span>
<span>                 <span class="va">one_title</span>, <span class="va">one_sex</span>, age <span class="op">=</span> <span class="va">data_sub</span><span class="op">$</span><span class="va">age2</span>,</span>
<span>                 fare <span class="op">=</span> <span class="va">data_sub</span><span class="op">$</span><span class="va">fare2</span>, <span class="va">one_pclass</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data_sub</span><span class="op">)</span></span>
<span><span class="co">#&gt;   survived officer royal Master miss mrs Mr female male        age       fare 1pclass</span></span>
<span><span class="co">#&gt; 1        1       0     0      0    1   0  0      1    0 0.37369494 0.02537431       0</span></span>
<span><span class="co">#&gt; 2        1       0     0      0    0   0  1      0    1 0.51774510 0.06929139       1</span></span>
<span><span class="co">#&gt; 3        0       0     0      0    0   0  1      0    1 0.32359053 0.13575256       0</span></span>
<span><span class="co">#&gt; 4        0       0     0      1    0   0  0      0    1 0.07306851 0.04113566       0</span></span>
<span><span class="co">#&gt; 5        0       0     0      0    0   0  1      0    1 0.37995799 0.01571255       0</span></span>
<span><span class="co">#&gt; 6        0       0     0      0    0   0  1      0    1 0.48016680 0.01415106       0</span></span>
<span><span class="co">#&gt;   2pclass 3pclass</span></span>
<span><span class="co">#&gt; 1       1       0</span></span>
<span><span class="co">#&gt; 2       0       0</span></span>
<span><span class="co">#&gt; 3       0       1</span></span>
<span><span class="co">#&gt; 4       0       1</span></span>
<span><span class="co">#&gt; 5       0       1</span></span>
<span><span class="co">#&gt; 6       0       1</span></span></code></pre></div>
</div>
<div id="split-data" class="section level3" number="6.1.3">
<h3>
<span class="header-section-number">6.1.3</span> Split Data<a class="anchor" aria-label="anchor" href="#split-data"><i class="fas fa-link"></i></a>
</h3>
<p>The splitting consists of two splits:</p>
<ul>
<li>An outer split (the original split, remember we got a training and test split without the response “survived”).</li>
<li>An inner split (we will split the training data set further into another training and test split with known response).
The inner split is important to assess the model’s performance and potential overfitting.</li>
</ul>
<p>Outer split:</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train</span> <span class="op">=</span> <span class="va">data_sub</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data_sub</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">=</span> <span class="va">data_sub</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data_sub</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>Inner split:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span>, <span class="fl">0.7</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sub_train</span> <span class="op">=</span> <span class="va">train</span><span class="op">[</span><span class="va">indices</span>,<span class="op">]</span></span>
<span><span class="va">sub_test</span> <span class="op">=</span> <span class="va">train</span><span class="op">[</span><span class="op">-</span><span class="va">indices</span>,<span class="op">]</span></span></code></pre></div>
<p>What is the difference between the two splits? (Tip: have a look at the variable survived.)</p>
</div>
<div id="training" class="section level3" number="6.1.4">
<h3>
<span class="header-section-number">6.1.4</span> Training<a class="anchor" aria-label="anchor" href="#training"><i class="fas fa-link"></i></a>
</h3>
<p>In the next step we will fit a Keras model on the training data of the inner split:</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/tensorflow">tensorflow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com">keras</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/set_random_seed.html">set_random_seed</a></span><span class="op">(</span><span class="fl">321L</span>, disable_gpu <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># Already sets R's random seed.</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/keras_model_sequential.html">keras_model_sequential</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">20L</span>, input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sub_train</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span>,</span>
<span>              activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">20L</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">20L</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Output layer consists of the 1-hot encoded variable "survived" -&gt; 2 units.</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/keras/man/layer_dense.html">layer_dense</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">2L</span>, activation <span class="op">=</span> <span class="st">"softmax"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model: "sequential"</span></span>
<span><span class="co">#&gt; __________________________________________________________________________________________</span></span>
<span><span class="co">#&gt;  Layer (type)                           Output Shape                        Param #       </span></span>
<span><span class="co">#&gt; ==========================================================================================</span></span>
<span><span class="co">#&gt;  dense_3 (Dense)                        (None, 20)                          280           </span></span>
<span><span class="co">#&gt;  dense_2 (Dense)                        (None, 20)                          420           </span></span>
<span><span class="co">#&gt;  dense_1 (Dense)                        (None, 20)                          420           </span></span>
<span><span class="co">#&gt;  dense (Dense)                          (None, 2)                           42            </span></span>
<span><span class="co">#&gt; ==========================================================================================</span></span>
<span><span class="co">#&gt; Total params: 1,162</span></span>
<span><span class="co">#&gt; Trainable params: 1,162</span></span>
<span><span class="co">#&gt; Non-trainable params: 0</span></span>
<span><span class="co">#&gt; __________________________________________________________________________________________</span></span>
<span></span>
<span><span class="va">model_history</span> <span class="op">=</span></span>
<span><span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html">compile</a></span><span class="op">(</span>loss <span class="op">=</span> <span class="va">loss_categorical_crossentropy</span>,</span>
<span>          optimizer <span class="op">=</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/optimizer_adamax.html">optimizer_adamax</a></span><span class="op">(</span>learning_rate <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_history</span> <span class="op">=</span></span>
<span>  <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html">fit</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">sub_train</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/to_categorical.html">to_categorical</a></span><span class="op">(</span><span class="va">sub_train</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, num_classes <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>,</span>
<span>        epochs <span class="op">=</span> <span class="fl">100L</span>, batch_size <span class="op">=</span> <span class="fl">32L</span>,</span>
<span>        validation_split <span class="op">=</span> <span class="fl">0.2</span>,   <span class="co">#Again a test set used by the algorithm.</span></span>
<span>        shuffle <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_history</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-ML_workflow_files/figure-html/chunk_chapter4_58-1.png" width="100%" style="display: block; margin: auto;"></div>
<details><summary><strong><span style="color: #CC2FAA;">Torch</span></strong>
</summary><p>
</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs">torch</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_manual_seed.html">torch_manual_seed</a></span><span class="op">(</span><span class="fl">321L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_torch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_sequential.html">nn_sequential</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_linear.html">nn_linear</a></span><span class="op">(</span>in_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sub_train</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, out_features <span class="op">=</span> <span class="fl">20L</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_relu.html">nn_relu</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_linear.html">nn_linear</a></span><span class="op">(</span><span class="fl">20L</span>, <span class="fl">20L</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_relu.html">nn_relu</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nn_linear.html">nn_linear</a></span><span class="op">(</span><span class="fl">20L</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/optim_adam.html">optim_adam</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">model_torch</span><span class="op">$</span><span class="va">parameters</span>, lr <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_torch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">sub_train</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">Y_torch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="va">sub_train</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>, dtype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_dtype.html">torch_long</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sub_train</span><span class="op">)</span>, <span class="fl">20L</span><span class="op">)</span></span>
<span>  <span class="va">opt</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">pred</span> <span class="op">=</span> <span class="fu">model_torch</span><span class="op">(</span><span class="va">X_torch</span><span class="op">[</span><span class="va">indices</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">loss</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nnf_cross_entropy.html">nnf_cross_entropy</a></span><span class="op">(</span><span class="va">pred</span>, <span class="va">Y_torch</span><span class="op">[</span><span class="va">indices</span><span class="op">]</span>, reduction <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">loss</span><span class="op">)</span></span>
<span>  <span class="va">loss</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">opt</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.707869</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.686436</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.659611</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.654673</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.627494</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.68805</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.690998</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.652452</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.542723</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.553087</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.664908</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.708627</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.537437</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.43455</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.667144</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.496684</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.570908</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.597058</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.468032</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.649413</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.555161</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.657658</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.587866</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.5941</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.447766</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.604198</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.554323</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.643397</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.536915</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.674608</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.420315</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.32588</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.464963</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.596521</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.530618</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.234835</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.291255</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.929026</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.625346</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.278064</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.726598</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.62555</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.481452</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.673818</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.576146</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.475387</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.457026</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.50311</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.414785</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.385994</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.395334</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.676871</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.393855</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.710248</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.516789</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.530883</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.728959</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.470274</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.51207</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.453122</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.905312</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.4599</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.570826</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.445953</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.468076</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.565009</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.469997</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.600031</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.426152</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.700782</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.352638</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.400375</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.459513</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.568515</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.497609</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.600834</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.798421</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.327998</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.387632</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.63566</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.304985</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.526177</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.592815</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.346981</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.529488</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.623992</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.437405</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.471444</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.481523</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.595865</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.409776</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.408433</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.469692</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.652108</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.457667</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.535109</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.487944</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.588671</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.519266</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.4564</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.420434</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.564046</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.546535</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.655195</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.539748</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.451041</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.488228</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.443963</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.379549</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.592209</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.39709</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.403911</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.286926</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.746202</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.557143</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.343428</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.694007</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.418217</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.512508</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.605517</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.505859</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.57816</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.56861</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.371636</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.584577</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.542919</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.458773</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.673591</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.616572</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.54045</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.482451</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.413941</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.474845</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.419692</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.493641</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.499719</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.47251</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.759404</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.478613</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.446379</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.484713</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.532843</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.320036</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.546959</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.631938</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.367877</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.696314</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.858233</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.694158</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.68525</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.474375</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.547824</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.436111</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.538776</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.505266</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.47963</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.478373</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.517894</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.431919</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.558722</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.459529</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.465366</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.578217</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.603758</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.506026</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.383555</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.419733</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.515685</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.377787</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.251414</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.487529</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.595669</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.421177</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.35105</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.423871</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.474373</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.268141</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.518056</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.31674</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.46961</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.431192</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.329849</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.329375</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.609598</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.52314</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.402313</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.42145</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.634766</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.635958</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.46861</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.277993</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.482526</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.783625</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.481016</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.453809</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.532373</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.614475</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.429902</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.466269</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.52095</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.515713</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.594814</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.620781</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.496087</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.62666</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.574774</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.709346</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.696121</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.466134</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.390352</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.379508</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.518273</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.49647</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.409525</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.46741</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.58821</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.354203</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.54532</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.347564</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.399711</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.689771</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.68454</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.476687</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.44997</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.455688</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.403596</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.388859</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.532802</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.675519</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.496137</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.605388</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.465515</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.41161</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.349016</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.844552</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.45283</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.356554</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.324578</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.501251</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.740512</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.45971</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.4173</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.462109</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.505691</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.461158</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.457387</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.619157</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.540819</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.617918</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.46706</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.355819</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.883221</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.518348</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.44704</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.559336</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.297896</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.412469</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.502253</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.632805</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.374276</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.529211</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.361833</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.480561</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.390684</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.59659</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.2792</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.546276</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.366373</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.431727</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.511097</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.393672</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.510827</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.379485</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.236956</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.453161</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.576676</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.38702</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.511233</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.421102</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.671416</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.449251</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.421628</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.467304</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.471103</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.326304</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.330048</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.355706</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.37242</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.380477</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.445888</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.451437</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.44118</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.545506</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.454936</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.559109</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.554526</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.413272</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.433541</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.35778</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.640296</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.671153</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.271047</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.458804</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.298442</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.422499</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.379167</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.37151</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.29079</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.343601</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.309687</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.640103</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.374724</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.44974</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.349522</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.569582</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.55222</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.75569</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.382098</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.441822</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.608224</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.408617</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.399517</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.3563</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.582843</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.421269</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.458882</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.543267</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.497163</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.482459</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.561153</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.403645</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.417156</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.317258</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.543135</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.518725</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.43794</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.283879</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.341411</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.560608</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.700514</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.652319</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.370861</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.500019</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.701887</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.598595</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.446417</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.415801</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.555131</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.505287</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.663954</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.609121</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.438152</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.531093</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.558249</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.47065</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.476193</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.487094</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.398958</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.370758</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.474866</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.397224</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.429614</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.334949</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.71336</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.414789</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.332019</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.477892</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.317209</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.327091</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.419255</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.273266</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.573711</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.45249</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.346723</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.495111</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.381574</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.244849</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.424235</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.269414</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.607508</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.567444</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.606521</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.357238</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.60519</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.448005</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.650992</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.35432</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.724178</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.449799</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.421666</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.579403</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.945731</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.507651</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.624709</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.477855</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.297618</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.317562</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.578056</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.469425</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.694902</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.502019</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.633915</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.969901</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.416737</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.592856</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.394041</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.392264</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.353905</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.595177</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.359545</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.57412</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.364393</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.584685</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.583028</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.481971</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.383393</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.376592</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.586399</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.413973</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.342848</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.514671</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.406365</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.374424</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.290655</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.425498</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.420754</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.648903</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.859324</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.69948</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.432994</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.366822</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.50001</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.454298</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.475173</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.383777</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.445096</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.415456</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.461693</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.453002</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.519292</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.351406</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.608089</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.560487</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.416949</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.488941</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.562287</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.451058</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.501812</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.530042</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.382543</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.627286</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.569558</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.433292</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.392974</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.483538</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.493791</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.509549</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.519145</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.251333</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.35272</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.542718</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.506634</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.455043</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.526545</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.286775</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.445055</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.462968</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.420297</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.426609</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.22259</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.435372</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.484453</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.410166</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.297978</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.613961</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.479021</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.620836</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.625761</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.464297</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.276816</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.57245</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.380823</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.571787</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.349566</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.430171</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.569651</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.529671</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.428989</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.494857</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.603523</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.595237</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.60492</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.517747</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.492854</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.60878</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.534464</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.49266</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.463699</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.453637</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span>
<span><span class="co">#&gt; torch_tensor</span></span>
<span><span class="co">#&gt; 0.497914</span></span>
<span><span class="co">#&gt; [ CPUFloatType{} ][ grad_fn = &lt;NllLossBackward0&gt; ]</span></span></code></pre></div>
<p>Note: the “nnf_cross_entropy” expects predictions on the scale of the linear predictors (the loss function itself will apply the softmax!).</p>

</details><p><br></p>
</div>
<div id="evaluation" class="section level3" number="6.1.5">
<h3>
<span class="header-section-number">6.1.5</span> Evaluation<a class="anchor" aria-label="anchor" href="#evaluation"><i class="fas fa-link"></i></a>
</h3>
<p>We will predict the variable “survived” for the test set of the inner split and calculate the accuracy:</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">=</span></span>
<span>  <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">sub_test</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predicted</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># Ternary operator.</span></span>
<span><span class="va">observed</span> <span class="op">=</span> <span class="va">sub_test</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">(</span><span class="va">accuracy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">predicted</span> <span class="op">==</span> <span class="va">observed</span><span class="op">)</span><span class="op">)</span>  <span class="co"># (...): Show output.</span></span>
<span><span class="co">#&gt; [1] 0.8121827</span></span></code></pre></div>
<details><summary><strong><span style="color: #CC2FAA;">Torch</span></strong>
</summary><p>
</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_torch</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">preds_torch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/torch/man/nnf_softmax.html">nnf_softmax</a></span><span class="op">(</span><span class="fu">model_torch</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_tensor.html">torch_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">sub_test</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          dim <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="va">preds_torch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">preds_torch</span><span class="op">)</span></span>
<span><span class="va">preds_torch</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">preds_torch</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">accuracy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">preds_torch</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">==</span> <span class="va">observed</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7817259</span></span></code></pre></div>
<pre><code>Now we have to use the softmax function.</code></pre>

</details><p><br></p>
</div>
<div id="predictions-and-submission" class="section level3" number="6.1.6">
<h3>
<span class="header-section-number">6.1.6</span> Predictions and Submission<a class="anchor" aria-label="anchor" href="#predictions-and-submission"><i class="fas fa-link"></i></a>
</h3>
<p>When we are satisfied with the performance of our model in the inner split, we will create predictions for the test data of the outer split.
To do so, we take all observations that belong to the outer test split (use the filter function) and remove the survived (NAs) columns:</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">submit</span> <span class="op">=</span> </span>
<span>  <span class="va">test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">survived</span><span class="op">)</span></span></code></pre></div>
<p>We cannot assess the performance on the test split because the true survival ratio is unknown, however, we can now submit our predictions to the submission server at <a href="http://rhsbio7.uni-regensburg.de:8500" target="_blank" rel="noopener">http://rhsbio7.uni-regensburg.de:8500</a>.
To do so, we have to transform our survived probabilities into actual 0/1 predictions (probabilities are not allowed) and create a .csv file:</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">=</span> <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">submit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>All values &gt; 0.5 will be set to 1 and values &lt; 0.5 to zero.
For the submission it is critical to change the predictions into a data.frame, select the second column (the probability to survive), and save it with the write.csv function:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, file <span class="op">=</span> <span class="st">"Max_1.csv"</span><span class="op">)</span></span></code></pre></div>
<p>The file name is used as the ID on the submission server, so change it to whatever you want as long as you can identify yourself.</p>
<p><strong>Annotation: The AUC is (always) higher for probabilities than for 0/1 data (depending on the implementation and definition of the AUC). We expect you to upload 0/1 data (usage scenarios, no theoretical ones)! Hint for cheaters (or if you just forget conversion): Your upload is converted to 0/1 data according to ifelse(… &lt; 0.5, 0, 1).</strong></p>
  <hr>
<strong><span style="color: #0011AA; font-size:18px;">Task</span></strong><br><p>The tasks below follow the above section about machine learning pipelines. We will use the titanic_ml data set from the EcoData package to see a pipeline. The goal is to predict if a passenger survives or not.</p>
<p>First, we should look at the data and do some feature engineering / selection. Give it a try! (Ideas can be found <a href="https://www.kaggle.com/c/titanic/notebooks?sortBy=hotness&amp;group=everyone&amp;pageSize=20&amp;competitionId=3136&amp;language=R" target="_blank" rel="noopener">here</a>.)</p>
  <details><summary><strong><span style="color: #0011AA; font-size:18px;">Solution</span></strong>
    </summary><p>
</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com">keras</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/tensorflow">tensorflow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/">randomForest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TheoreticalEcology/">EcoData</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/set_random_seed.html">set_random_seed</a></span><span class="op">(</span><span class="fl">54321L</span>, disable_gpu <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>    <span class="co"># Already sets R's random seed.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">titanic_ml</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">titanic_ml</span></span></code></pre></div>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1309 obs. of  14 variables:</span></span>
<span><span class="co">#&gt;  $ pclass   : int  2 1 3 3 3 3 3 1 3 1 ...</span></span>
<span><span class="co">#&gt;  $ survived : int  1 1 0 0 0 0 0 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ name     : chr  "Sinkkonen, Miss. Anna" "Woolner, Mr. Hugh" "Sage, Mr. Douglas Bullen" "Palsson, Master. Paul Folke" ...</span></span>
<span><span class="co">#&gt;  $ sex      : Factor w/ 2 levels "female","male": 1 2 2 2 2 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ age      : num  30 NA NA 6 30.5 38.5 20 53 NA 42 ...</span></span>
<span><span class="co">#&gt;  $ sibsp    : int  0 0 8 3 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ parch    : int  0 0 2 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ ticket   : Factor w/ 929 levels "110152","110413",..: 221 123 779 542 589 873 472 823 588 834 ...</span></span>
<span><span class="co">#&gt;  $ fare     : num  13 35.5 69.55 21.07 8.05 ...</span></span>
<span><span class="co">#&gt;  $ cabin    : Factor w/ 187 levels "","A10","A11",..: 1 94 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ embarked : Factor w/ 4 levels "","C","Q","S": 4 4 4 4 4 4 4 2 4 2 ...</span></span>
<span><span class="co">#&gt;  $ boat     : Factor w/ 28 levels "","1","10","11",..: 3 28 1 1 1 1 1 19 1 15 ...</span></span>
<span><span class="co">#&gt;  $ body     : int  NA NA NA NA 50 32 NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ home.dest: Factor w/ 370 levels "","?Havana, Cuba",..: 121 213 1 1 1 1 322 350 1 1 ...</span></span>
<span></span>
<span><span class="va">indicesPredict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">titanic_ml</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">indicesTrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">titanic_ml</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">subset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">indicesTrain</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">indicesTrain</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.7</span>, replace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">indicesTest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">indicesTrain</span><span class="op">[</span><span class="op">-</span><span class="va">subset</span><span class="op">]</span><span class="op">)</span> <span class="co"># Mind order of instructions!</span></span>
<span><span class="va">indicesTrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">indicesTrain</span><span class="op">[</span><span class="va">subset</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Determine labels. As they are fixed from now on, samples must not be left!</span></span>
<span><span class="co"># Impute when necessary. </span></span>
<span><span class="va">labelsTrain</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">survived</span><span class="op">[</span><span class="va">indicesTrain</span><span class="op">]</span></span>
<span><span class="va">labelsTest</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">survived</span><span class="op">[</span><span class="va">indicesTest</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Parameter "body" has nearly no information).</span></span>
<span><span class="co"># Parameter "name" was already processed above.</span></span>
<span><span class="co"># Parameter "ticket" may include (other) information, but leave it out for now.</span></span>
<span><span class="co"># Parameter "survived" is the target variable.</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">body</span>, <span class="op">-</span><span class="va">name</span>, <span class="op">-</span><span class="va">ticket</span>, <span class="op">-</span><span class="va">survived</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span><span class="op">)</span>  <span class="co"># "pclass" makes only sense as a factor.</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cabin</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="co">#&gt; [1] 0.2074303</span></span>
<span><span class="co">#&gt; [1] 0.9169675</span></span>
<span><span class="co">#&gt; [1] 0.977433</span></span>
<span></span>
<span><span class="co"># Most people have no cabin (21% in 1st, 92% in 2nd and 98% in 3rd class).</span></span>
<span><span class="co"># Dummy code the availability of a cabin.</span></span>
<span><span class="co"># This is NOT one-hot encoding! Dummy coded variables use n-1 variables!</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">cabin</span> <span class="op">=</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cabin</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Impute values for parameter "embarked":</span></span>
<span>  <span class="co"># Leave parameters with too many levels or causal inverse ones (assumed).</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">boat</span>, <span class="op">-</span><span class="va">home.dest</span><span class="op">)</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># Leave samples with missing values.</span></span>
<span>  </span>
<span>  <span class="va">missingIndices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">embarked</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">toPredict</span> <span class="op">=</span> <span class="va">tmp</span><span class="op">[</span><span class="va">missingIndices</span>, <span class="op">-</span><span class="fl">8</span><span class="op">]</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="va">tmp</span><span class="op">[</span><span class="op">-</span><span class="va">missingIndices</span>,<span class="op">]</span> <span class="co"># Leave samples that should be predicted.</span></span>
<span>  <span class="va">tmp</span><span class="op">$</span><span class="va">embarked</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">embarked</span><span class="op">)</span> <span class="co"># Remove unused levels ("").</span></span>
<span>  </span>
<span>  <span class="co"># Random forests and simple regression trees don't need scaling.</span></span>
<span>  <span class="co"># Use a simple regression tree instead of a random forest here,</span></span>
<span>  <span class="co"># we have only 2 missing values.</span></span>
<span>  <span class="co"># And a simple regression tree is easy to visualize.</span></span>
<span>  <span class="va">regressionTree</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">embarked</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tmp</span>,</span>
<span>                         control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>minsplit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">rpart.plot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">regressionTree</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-ML_workflow_files/figure-html/chunk_chapter4_task_40-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">prediction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">regressionTree</span>, <span class="va">toPredict</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">embarked</span><span class="op">[</span><span class="va">index</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">embarked</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">embarked</span><span class="op">)</span> <span class="co"># Remove unused levels ("").</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   1   2   3 </span></span>
<span><span class="co">#&gt; 323 277 709</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1309</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">home.dest</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1309</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">home.dest</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co"># "pclass", "sex", "sibsp", "parch", "boat" and "home.dest" have no missing values.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">fare</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;   0.000   7.896  14.454  33.295  31.275 512.329       1</span></span>
<span><span class="co"># Parameter "fare" has 1 NA entry. Impute the mean.</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">fare</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">fare</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">fare</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">home.dest</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">home.dest</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">=</span> <span class="st">"unknown"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">boat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">boat</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">=</span> <span class="st">"none"</span></span>
<span></span>
<span><span class="co"># Impute values for "age":</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">home.dest</span><span class="op">)</span> <span class="co"># Leave parameters with too many levels.</span></span>
<span>  </span>
<span>  <span class="va">missingIndices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">toPredict</span> <span class="op">=</span> <span class="va">tmp</span><span class="op">[</span><span class="va">missingIndices</span>, <span class="op">-</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">tmp</span> <span class="op">=</span> <span class="va">tmp</span><span class="op">[</span><span class="op">-</span><span class="va">missingIndices</span>,<span class="op">]</span> <span class="co"># Leave samples that should be predicted.</span></span>
<span>  </span>
<span>  <span class="va">forest</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmp</span><span class="op">[</span>,<span class="op">-</span><span class="fl">3</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span>  <span class="va">prediction</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">toPredict</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">index</span><span class="op">]</span> <span class="op">=</span> <span class="va">prediction</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1309 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;  $ pclass   : Factor w/ 3 levels "1","2","3": 2 1 3 3 3 3 3 1 3 1 ...</span></span>
<span><span class="co">#&gt;  $ sex      : Factor w/ 2 levels "female","male": 1 2 2 2 2 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ age      : num  30 36.7 13.9 6 30.5 ...</span></span>
<span><span class="co">#&gt;  $ sibsp    : int  0 0 8 3 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ parch    : int  0 0 2 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ fare     : num  13 35.5 69.55 21.07 8.05 ...</span></span>
<span><span class="co">#&gt;  $ cabin    : num  0 1 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ embarked : Factor w/ 3 levels "C","Q","S": 3 3 3 3 3 3 3 1 3 1 ...</span></span>
<span><span class="co">#&gt;  $ boat     : Factor w/ 28 levels "none","1","10",..: 3 28 1 1 1 1 1 19 1 15 ...</span></span>
<span><span class="co">#&gt;  $ home.dest: Factor w/ 370 levels "unknown","?Havana, Cuba",..: 121 213 1 1 1 1 322 350 1 1 ...</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># One-hot encoding of "pclass", "sex", "cabin", "embarked", "boat" and "home.dest":</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">element</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pclass"</span>, <span class="st">"sex"</span>, <span class="st">"cabin"</span>, <span class="st">"embarked"</span>, <span class="st">"boat"</span>, <span class="st">"home.dest"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># Build integer representation:</span></span>
<span>    <span class="co"># This MUST start at 0, otherwise, the encoding is wrong!!</span></span>
<span>      <span class="va">integers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">element</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">integers</span> <span class="op">=</span> <span class="va">integers</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">integers</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Determine number of classes:</span></span>
<span>    <span class="va">num_classes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">element</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Encode:</span></span>
<span>    <span class="va">encoded</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/keras/man/k_one_hot.html">k_one_hot</a></span><span class="op">(</span><span class="va">integers</span>, <span class="va">num_classes</span><span class="op">)</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Copy factor names.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">encoded</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">element</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">element</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">data</span> <span class="op">=</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">element</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Remove original column.</span></span>
<span>    <span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">encoded</span><span class="op">)</span>  <span class="co"># Plug in new (encoded) columns.</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># Scale parameters (including one-hot encoded):</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split into training, test and prediction set:</span></span>
<span><span class="co"># Be careful! You need matrices, no data.frames!</span></span>
<span><span class="va">train</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">indicesTrain</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">indicesTest</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">predict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">indicesPredict</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
    
  </details><br><hr>
<strong><span style="color: #0011AA; font-size:18px;">Task</span></strong><br><p>Build a neural network to make predictions and check performance on the hold-out data.</p>
  <details><summary><strong><span style="color: #0011AA; font-size:18px;">Solution</span></strong>
    </summary><p>
</p>
<div class="inline-figure"><img src="06-ML_workflow_files/figure-html/chunk_chapter4_task_41-1.png" width="100%" style="display: block; margin: auto;"></div>
<pre><code>#&gt;           labelsTest
#&gt; prediction   0   1
#&gt;          0 106  14
#&gt;          1  15  62
#&gt; Accuracy:
#&gt; [1] 0.8527919</code></pre>
    
  </details><br><hr>
<strong><span style="color: #0011AA; font-size:18px;">Task</span></strong><br><p>Play around with model parameters, optimizer(learning_rate = …), epochs = …, number of hidden nodes in layers: units = …, regularization: kernel_regularizer = …, bias_regularizer = … <strong>-</strong> Try to maximize the model’s accuracy for the hold-out data.</p>
<p><strong>Hint</strong>: There are a lot different activation functions like “linear,” “softmax,” “relu,” “leaky_relu,” “gelu,” “selu,” “elu,” “exponential,” “sigmoid,” “tanh,” “softplus,” “softsign,” etc. But be careful, this might be <em>very</em> computation-intensive (especially “gelu,” tanh” or “softmax”).
Every activation function has its own properties, requirements (!), advantages and disadvantages. Choose them wisely!</p>
<p>You should get an accuracy of at least 90%. (Before looking into the solution…) Try to be better than the solution.</p>
  <details><summary><strong><span style="color: #0011AA; font-size:18px;">Solution</span></strong>
    </summary><p>
</p>
<div class="inline-figure"><img src="06-ML_workflow_files/figure-html/chunk_chapter4_task_42-1.png" width="100%" style="display: block; margin: auto;"></div>
<pre><code>#&gt;           labelsTest
#&gt; prediction   0   1
#&gt;          0 120   5
#&gt;          1   1  71
#&gt; Accuracy:
#&gt; [1] 0.9695431</code></pre>
    
  </details><br><hr>
<strong><span style="color: #0011AA; font-size:18px;">Task</span></strong><br><p>Now try your above solution (<strong>the exactly same one!</strong>) with another seed to check for overfitting (on the seed!) of your procedure.</p>
  <details><summary><strong><span style="color: #0011AA; font-size:18px;">Solution</span></strong>
    </summary><p>
</p>
<div class="inline-figure"><img src="06-ML_workflow_files/figure-html/chunk_chapter4_task_43-1.png" width="100%" style="display: block; margin: auto;"></div>
<pre><code>#&gt;           labelsTest
#&gt; prediction   0   1
#&gt;          0 112   5
#&gt;          1   9  71
#&gt; Accuracy:
#&gt; [1] 0.928934</code></pre>
    
  </details><br><hr>
<strong><span style="color: #0011AA; font-size:18px;">Task</span></strong><br><p>Make predictions and submit them via our <a href="https://elearning.uni-regensburg.de/mod/page/view.php?id=1150717" target="_blank" rel="noopener">submission server</a>.</p>
  <details><summary><strong><span style="color: #0011AA; font-size:18px;">Solution</span></strong>
    </summary><p>
</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prediction</span> <span class="op">=</span></span>
<span>  <span class="va">model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predict</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take label with highest probability:</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="op">(</span><span class="va">prediction</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">prediction</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">prediction</span><span class="op">)</span>, file <span class="op">=</span> <span class="st">"submission_NN.csv"</span><span class="op">)</span></span></code></pre></div>
    
  </details><br><hr>
</div>
</div>
<div id="mlr" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Bonus - Machine Learning Pipelines with mlr3<a class="anchor" aria-label="anchor" href="#mlr"><i class="fas fa-link"></i></a>
</h2>
<p>As we have seen today, many of the machine learning algorithms are distributed over several packages but the general machine learning pipeline is very similar for all models: feature engineering, feature selection, hyperparameter tuning and cross-validation.</p>
<p>The idea of the mlr3 framework is now to provide a general machine learning interface which you can use to build reproducible and automatic machine learning pipelines. The key features of mlr3 are:</p>
<ul>
<li>All common machine learning packages are integrated into mlr3, you can easily switch between different machine learning algorithms.</li>
<li>A common ‘language’/workflow to specify machine learning pipelines.</li>
<li>Support for different cross-validation strategies.</li>
<li>Hyperparameter tuning for all supported machine learning algorithms.</li>
<li>Ensemble models.</li>
</ul>
<p>Useful links:</p>
<ul>
<li>
<a href="https://mlr3book.mlr-org.com/" target="_blank" rel="noopener">mlr3-book</a> (still in work)</li>
<li><a href="https://mlr3.mlr-org.com/" target="_blank" rel="noopener">mlr3 website</a></li>
<li><a href="https://cheatsheets.mlr-org.com/mlr3.pdf" target="_blank" rel="noopener">mlr3 cheatsheet</a></li>
</ul>
<div id="mlr3---the-basic-workflow" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> mlr3 - The Basic Workflow<a class="anchor" aria-label="anchor" href="#mlr3---the-basic-workflow"><i class="fas fa-link"></i></a>
</h3>
<p>The mlr3 package actually consists of several packages for different tasks (e.g. mlr3tuning for hyperparameter tuning, mlr3pipelines for data preparation pipes). But let’s start with the basic workflow:</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TheoreticalEcology/">EcoData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https:///mlr3measures.mlr-org.com">mlr3measures</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">nasa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">nasa</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    4687 obs. of  40 variables:</span></span>
<span><span class="co">#&gt;  $ Neo.Reference.ID            : int  3449084 3702322 3406893 NA 2363305 3017307 2438430 3653917 3519490 2066391 ...</span></span>
<span><span class="co">#&gt;  $ Name                        : int  NA 3702322 3406893 3082923 2363305 3017307 2438430 3653917 3519490 NA ...</span></span>
<span><span class="co">#&gt;  $ Absolute.Magnitude          : num  18.7 22.1 24.8 21.6 21.4 18.2 20 21 20.9 16.5 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.KM.min.          : num  0.4837 0.1011 0.0291 0.1272 0.1395 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.KM.max.          : num  1.0815 0.226 0.0652 0.2845 0.3119 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.M.min.           : num  483.7 NA 29.1 127.2 139.5 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.M.max.           : num  1081.5 226 65.2 284.5 311.9 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.Miles.min.       : num  0.3005 0.0628 NA 0.0791 0.0867 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.Miles.max.       : num  0.672 0.1404 0.0405 0.1768 0.1938 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.Feet.min.        : num  1586.9 331.5 95.6 417.4 457.7 ...</span></span>
<span><span class="co">#&gt;  $ Est.Dia.in.Feet.max.        : num  3548 741 214 933 1023 ...</span></span>
<span><span class="co">#&gt;  $ Close.Approach.Date         : Factor w/ 777 levels "1995-01-01","1995-01-08",..: 511 712 472 239 273 145 428 694 87 732 ...</span></span>
<span><span class="co">#&gt;  $ Epoch.Date.Close.Approach   : num  NA 1.42e+12 1.21e+12 1.00e+12 1.03e+12 ...</span></span>
<span><span class="co">#&gt;  $ Relative.Velocity.km.per.sec: num  11.22 13.57 5.75 13.84 4.61 ...</span></span>
<span><span class="co">#&gt;  $ Relative.Velocity.km.per.hr : num  40404 48867 20718 49821 16583 ...</span></span>
<span><span class="co">#&gt;  $ Miles.per.hour              : num  25105 30364 12873 30957 10304 ...</span></span>
<span><span class="co">#&gt;  $ Miss.Dist..Astronomical.    : num  NA 0.0671 0.013 0.0583 0.0381 ...</span></span>
<span><span class="co">#&gt;  $ Miss.Dist..lunar.           : num  112.7 26.1 NA 22.7 14.8 ...</span></span>
<span><span class="co">#&gt;  $ Miss.Dist..kilometers.      : num  43348668 10030753 1949933 NA 5694558 ...</span></span>
<span><span class="co">#&gt;  $ Miss.Dist..miles.           : num  26935614 6232821 1211632 5418692 3538434 ...</span></span>
<span><span class="co">#&gt;  $ Orbiting.Body               : Factor w/ 1 level "Earth": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ Orbit.ID                    : int  NA 8 12 12 91 NA 24 NA NA 212 ...</span></span>
<span><span class="co">#&gt;  $ Orbit.Determination.Date    : Factor w/ 2680 levels "2014-06-13 15:20:44",..: 69 NA 1377 1774 2275 2554 1919 731 1178 2520 ...</span></span>
<span><span class="co">#&gt;  $ Orbit.Uncertainity          : int  0 8 6 0 0 0 1 1 1 0 ...</span></span>
<span><span class="co">#&gt;  $ Minimum.Orbit.Intersection  : num  NA 0.05594 0.00553 NA 0.0281 ...</span></span>
<span><span class="co">#&gt;  $ Jupiter.Tisserand.Invariant : num  5.58 3.61 4.44 5.5 NA ...</span></span>
<span><span class="co">#&gt;  $ Epoch.Osculation            : num  2457800 2457010 NA 2458000 2458000 ...</span></span>
<span><span class="co">#&gt;  $ Eccentricity                : num  0.276 0.57 0.344 0.255 0.22 ...</span></span>
<span><span class="co">#&gt;  $ Semi.Major.Axis             : num  1.1 NA 1.52 1.11 1.24 ...</span></span>
<span><span class="co">#&gt;  $ Inclination                 : num  20.06 4.39 5.44 23.9 3.5 ...</span></span>
<span><span class="co">#&gt;  $ Asc.Node.Longitude          : num  29.85 1.42 170.68 356.18 183.34 ...</span></span>
<span><span class="co">#&gt;  $ Orbital.Period              : num  419 1040 682 427 503 ...</span></span>
<span><span class="co">#&gt;  $ Perihelion.Distance         : num  0.794 0.864 0.994 0.828 0.965 ...</span></span>
<span><span class="co">#&gt;  $ Perihelion.Arg              : num  41.8 359.3 350 268.2 179.2 ...</span></span>
<span><span class="co">#&gt;  $ Aphelion.Dist               : num  1.4 3.15 2.04 1.39 1.51 ...</span></span>
<span><span class="co">#&gt;  $ Perihelion.Time             : num  2457736 2456941 2457937 NA 2458070 ...</span></span>
<span><span class="co">#&gt;  $ Mean.Anomaly                : num  55.1 NA NA 297.4 310.5 ...</span></span>
<span><span class="co">#&gt;  $ Mean.Motion                 : num  0.859 0.346 0.528 0.843 0.716 ...</span></span>
<span><span class="co">#&gt;  $ Equinox                     : Factor w/ 1 level "J2000": 1 1 NA 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ Hazardous                   : int  0 0 0 1 1 0 0 0 1 1 ...</span></span></code></pre></div>
<p>Let’s drop time, name and ID variable and create a classification task:</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="va">nasa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Orbit.Determination.Date</span>,</span>
<span>                       <span class="op">-</span><span class="va">Close.Approach.Date</span>, <span class="op">-</span><span class="va">Name</span>, <span class="op">-</span><span class="va">Neo.Reference.ID</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">Hazardous</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Hazardous</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a classification task.</span></span>
<span><span class="va">task</span> <span class="op">=</span> <span class="va"><a href="https://mlr3.mlr-org.com/reference/TaskClassif.html">TaskClassif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"nasa"</span>, backend <span class="op">=</span> <span class="va">data</span>,</span>
<span>                       target <span class="op">=</span> <span class="st">"Hazardous"</span>, positive <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span></span></code></pre></div>
<p>Create a generic pipeline of data transformation (imputation <span class="math inline">\(\rightarrow\)</span> scaling <span class="math inline">\(\rightarrow\)</span> encoding of categorical variables):</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's create the preprocessing graph.</span></span>
<span><span class="va">preprocessing</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"imputeoor"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"encode"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Run the task.</span></span>
<span><span class="va">transformed_task</span> <span class="op">=</span> <span class="va">preprocessing</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">transformed_task</span><span class="op">$</span><span class="fu">missings</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    Hazardous           Absolute.Magnitude                Aphelion.Dist </span></span>
<span><span class="co">#&gt;                         4187                            0                            0 </span></span>
<span><span class="co">#&gt;           Asc.Node.Longitude                 Eccentricity    Epoch.Date.Close.Approach </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;             Epoch.Osculation         Est.Dia.in.Feet.max.         Est.Dia.in.Feet.min. </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;           Est.Dia.in.KM.max.           Est.Dia.in.KM.min.            Est.Dia.in.M.max. </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;            Est.Dia.in.M.min.        Est.Dia.in.Miles.max.        Est.Dia.in.Miles.min. </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;                  Inclination  Jupiter.Tisserand.Invariant                 Mean.Anomaly </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;                  Mean.Motion               Miles.per.hour   Minimum.Orbit.Intersection </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;     Miss.Dist..Astronomical.       Miss.Dist..kilometers.            Miss.Dist..lunar. </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;            Miss.Dist..miles.                     Orbit.ID           Orbit.Uncertainity </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;               Orbital.Period               Perihelion.Arg          Perihelion.Distance </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;              Perihelion.Time  Relative.Velocity.km.per.hr Relative.Velocity.km.per.sec </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;              Semi.Major.Axis                Equinox.J2000             Equinox..MISSING </span></span>
<span><span class="co">#&gt;                            0                            0                            0 </span></span>
<span><span class="co">#&gt;          Orbiting.Body.Earth       Orbiting.Body..MISSING </span></span>
<span><span class="co">#&gt;                            0                            0</span></span></code></pre></div>
<p>We can even visualize the preprocessing graph:</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preprocessing</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-ML_workflow_files/figure-html/chunk_chapter4_68-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Now, to test our model (random forest) 10-fold cross-validated, we will do:</p>
<ul>
<li>Specify the missing target rows as validation so that they will be ignored.</li>
<li>Specify the cross-validation, the learner (the machine learning model we want to use), and the measurement (AUC).</li>
<li>Run (benchmark) our model.</li>
</ul>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transformed_task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Hazardous Absolute.Magnitude Aphelion.Dist Asc.Node.Longitude Eccentricity</span></span>
<span><span class="co">#&gt;    1:         0        -0.81322649   -0.38042005       -1.140837452 -0.315605975</span></span>
<span><span class="co">#&gt;    2:         0         0.02110348    0.94306517       -1.380254611  0.744287645</span></span>
<span><span class="co">#&gt;    3:         0         0.68365964    0.10199889        0.044905370 -0.068280074</span></span>
<span><span class="co">#&gt;    4:         1        -0.10159210   -0.38415066        1.606769281 -0.392030729</span></span>
<span><span class="co">#&gt;    5:         1        -0.15067034   -0.29632490        0.151458877 -0.516897963</span></span>
<span><span class="co">#&gt;   ---                                                                           </span></span>
<span><span class="co">#&gt; 4683:      &lt;NA&gt;        -0.32244415    0.69173184       -0.171022906  1.043608082</span></span>
<span><span class="co">#&gt; 4684:      &lt;NA&gt;         0.46280759   -0.24203066       -0.009803808 -0.006429588</span></span>
<span><span class="co">#&gt; 4685:      &lt;NA&gt;         1.51798962   -0.56422744        1.514551982 -1.045386877</span></span>
<span><span class="co">#&gt; 4686:      &lt;NA&gt;         0.16833819    0.14193044       -1.080452287  0.017146757</span></span>
<span><span class="co">#&gt; 4687:      &lt;NA&gt;        -0.05251387   -0.08643345       -0.013006704 -0.579210554</span></span>
<span><span class="co">#&gt;       Epoch.Date.Close.Approach Epoch.Osculation Est.Dia.in.Feet.max.</span></span>
<span><span class="co">#&gt;    1:                -4.7929881       0.14026773          0.271417899</span></span>
<span><span class="co">#&gt;    2:                 1.1058704      -0.26325244          0.032130074</span></span>
<span><span class="co">#&gt;    3:                 0.1591740      -7.76281014         -0.012841645</span></span>
<span><span class="co">#&gt;    4:                -0.7630231       0.24229559          0.048493723</span></span>
<span><span class="co">#&gt;    5:                -0.6305034       0.24229559          0.056169717</span></span>
<span><span class="co">#&gt;   ---                                                                </span></span>
<span><span class="co">#&gt; 4683:                 1.3635097       0.24229559          0.089353662</span></span>
<span><span class="co">#&gt; 4684:                 1.3635097       0.05711503         -0.003481174</span></span>
<span><span class="co">#&gt; 4685:                 1.3635097       0.24229559         -0.027260163</span></span>
<span><span class="co">#&gt; 4686:                 1.3635097       0.24229559          0.016872584</span></span>
<span><span class="co">#&gt; 4687:                 1.3635097       0.24229559          0.041493133</span></span>
<span><span class="co">#&gt;       Est.Dia.in.Feet.min. Est.Dia.in.KM.max. Est.Dia.in.KM.min. Est.Dia.in.M.max.</span></span>
<span><span class="co">#&gt;    1:          0.313407647        0.300713440        0.256568684       0.271095311</span></span>
<span><span class="co">#&gt;    2:         -0.029173486       -0.020055639        0.057560696       0.031844946</span></span>
<span><span class="co">#&gt;    3:         -0.093558135       -0.080340934        0.020159164      -0.013119734</span></span>
<span><span class="co">#&gt;    4:         -0.005746146        0.001880088        0.071169817       0.048206033</span></span>
<span><span class="co">#&gt;    5:          0.005243343        0.012169879        0.077553695       0.055880826</span></span>
<span><span class="co">#&gt;   ---                                                                             </span></span>
<span><span class="co">#&gt; 4683:          0.052751793        0.056653478        0.105151714       0.089059576</span></span>
<span><span class="co">#&gt; 4684:         -0.080157032       -0.067793075        0.027943967      -0.003760728</span></span>
<span><span class="co">#&gt; 4685:         -0.114200690       -0.099669182        0.008167747      -0.027535994</span></span>
<span><span class="co">#&gt; 4686:         -0.051017172       -0.040508543        0.044871533       0.016589844</span></span>
<span><span class="co">#&gt; 4687:         -0.015768679       -0.007504312        0.065347651       0.041206539</span></span>
<span><span class="co">#&gt;       Est.Dia.in.M.min. Est.Dia.in.Miles.max. Est.Dia.in.Miles.min. Inclination</span></span>
<span><span class="co">#&gt;    1:       0.291624502          2.620443e-01           0.258651038   0.5442288</span></span>
<span><span class="co">#&gt;    2:     -12.143577263          4.153888e-02           0.030928225  -0.5925952</span></span>
<span><span class="co">#&gt;    3:      -0.060269734          9.711407e-05         -10.258220292  -0.5164818</span></span>
<span><span class="co">#&gt;    4:       0.015659335          5.661810e-02           0.046501003   0.8225188</span></span>
<span><span class="co">#&gt;    5:       0.025161701          6.369158e-02           0.053806009  -0.6568722</span></span>
<span><span class="co">#&gt;   ---                                                                          </span></span>
<span><span class="co">#&gt; 4683:       0.066241198          9.427082e-02           0.085386142   0.8222493</span></span>
<span><span class="co">#&gt; 4684:      -0.048682099          8.722856e-03          -0.002961897   1.9818623</span></span>
<span><span class="co">#&gt; 4685:      -0.078118891         -1.318965e-02          -0.025591624  -0.5220442</span></span>
<span><span class="co">#&gt; 4686:      -0.023485512          2.747899e-02           0.016408144  -0.5912988</span></span>
<span><span class="co">#&gt; 4687:       0.006993074          5.016700e-02           0.039838758   0.6181969</span></span>
<span><span class="co">#&gt;       Jupiter.Tisserand.Invariant Mean.Anomaly Mean.Motion Miles.per.hour</span></span>
<span><span class="co">#&gt;    1:                   0.3840868  -1.02876096  0.31939530   -0.254130552</span></span>
<span><span class="co">#&gt;    2:                  -0.7801632  -4.55056211 -0.71151122    0.009333354</span></span>
<span><span class="co">#&gt;    3:                  -0.2872777  -4.55056211 -0.34600512   -0.866997591</span></span>
<span><span class="co">#&gt;    4:                   0.3403535   1.02239674  0.28551117    0.039031045</span></span>
<span><span class="co">#&gt;    5:                  -6.2415005   1.13265516  0.03164827   -0.995720084</span></span>
<span><span class="co">#&gt;   ---                                                                    </span></span>
<span><span class="co">#&gt; 4683:                  -0.6412806   0.01560046 -0.51852041    1.403775544</span></span>
<span><span class="co">#&gt; 4684:                   0.1346891   1.08051799  0.17477591    0.970963141</span></span>
<span><span class="co">#&gt; 4685:                   0.4810091   0.89998250  0.36895738   -1.150527134</span></span>
<span><span class="co">#&gt; 4686:                  -0.3061894   0.22720275 -0.35895074   -0.705980518</span></span>
<span><span class="co">#&gt; 4687:                  -0.2665930   0.22740438 -0.31462613   -0.239696213</span></span>
<span><span class="co">#&gt;       Minimum.Orbit.Intersection Miss.Dist..Astronomical. Miss.Dist..kilometers.</span></span>
<span><span class="co">#&gt;    1:                -5.45911858               -7.0769260             0.25122963</span></span>
<span><span class="co">#&gt;    2:                 0.07077092               -0.6830928            -1.08492125</span></span>
<span><span class="co">#&gt;    3:                -0.11099960               -0.9035573            -1.40898698</span></span>
<span><span class="co">#&gt;    4:                -5.45911858               -0.7188386            -4.48402327</span></span>
<span><span class="co">#&gt;    5:                -0.02962490               -0.8013948            -1.25881601</span></span>
<span><span class="co">#&gt;   ---                                                                           </span></span>
<span><span class="co">#&gt; 4683:                 0.30711241               -0.2728622            -0.48191427</span></span>
<span><span class="co">#&gt; 4684:                -0.05962478               -0.7879458            -1.23904708</span></span>
<span><span class="co">#&gt; 4685:                -0.10766868               -0.9303542            -1.44837625</span></span>
<span><span class="co">#&gt; 4686:                 0.08529226               -0.7077555            -1.12117355</span></span>
<span><span class="co">#&gt; 4687:                 0.50904764                0.1075071             0.07719897</span></span>
<span><span class="co">#&gt;       Miss.Dist..lunar. Miss.Dist..miles.   Orbit.ID Orbit.Uncertainity Orbital.Period</span></span>
<span><span class="co">#&gt;    1:         0.2398625        0.23810770 -9.6514722         -1.0070872     -0.3013135</span></span>
<span><span class="co">#&gt;    2:        -1.1742128       -1.18860632 -0.2412680          1.3770116      0.7811097</span></span>
<span><span class="co">#&gt;    3:        -4.7878719       -1.53463694 -0.1803606          0.7809869      0.1566040</span></span>
<span><span class="co">#&gt;    4:        -1.2298206       -1.24471124 -0.1803606         -1.0070872     -0.2866969</span></span>
<span><span class="co">#&gt;    5:        -1.3582490       -1.37428752  1.0225620         -1.0070872     -0.1552813</span></span>
<span><span class="co">#&gt;   ---                                                                                 </span></span>
<span><span class="co">#&gt; 4683:        -0.5360384       -0.54472804 -0.1194531         -0.7090748      0.3873214</span></span>
<span><span class="co">#&gt; 4684:        -1.3373272       -1.35317867 -0.3021755          1.3770116     -0.2345610</span></span>
<span><span class="co">#&gt; 4685:        -1.5588644       -1.57669598 -0.3326292          0.7809869     -0.3216884</span></span>
<span><span class="co">#&gt; 4686:        -1.2125793       -1.22731578 -0.1042262          0.7809869      0.1712806</span></span>
<span><span class="co">#&gt; 4687:         0.0556823        0.05228143 -0.2717218          0.4829746      0.1224733</span></span>
<span><span class="co">#&gt;       Perihelion.Arg Perihelion.Distance Perihelion.Time Relative.Velocity.km.per.hr</span></span>
<span><span class="co">#&gt;    1:   -1.170536399         -0.01831583      0.10526107                 -0.28167821</span></span>
<span><span class="co">#&gt;    2:    1.549452700          0.20604472     -0.28203779                 -0.00604459</span></span>
<span><span class="co">#&gt;    3:    1.470307933          0.61816146      0.20313227                 -0.92285430</span></span>
<span><span class="co">#&gt;    4:    0.769006449          0.09005898     -7.86832915                  0.02502487</span></span>
<span><span class="co">#&gt;    5:    0.006829799          0.52730977      0.26755741                 -1.05752264</span></span>
<span><span class="co">#&gt;   ---                                                                               </span></span>
<span><span class="co">#&gt; 4683:   -0.580282684         -0.65810123      0.03734532                  1.45280854</span></span>
<span><span class="co">#&gt; 4684:    0.839430173         -0.18350549      0.09156633                  1.00000402</span></span>
<span><span class="co">#&gt; 4685:   -1.168210857          0.62646993      0.27629790                 -1.21948041</span></span>
<span><span class="co">#&gt; 4686:    0.824836889          0.52899080      0.37994517                 -0.75439966</span></span>
<span><span class="co">#&gt; 4687:    0.016358127          1.22720096      0.37399573                 -0.26657713</span></span>
<span><span class="co">#&gt;       Relative.Velocity.km.per.sec Semi.Major.Axis Equinox.J2000 Equinox..MISSING</span></span>
<span><span class="co">#&gt;    1:                 -0.284140684      -0.2791037             1                0</span></span>
<span><span class="co">#&gt;    2:                 -0.008343348      -7.3370940             1                0</span></span>
<span><span class="co">#&gt;    3:                 -0.925697621       0.2204883             0                1</span></span>
<span><span class="co">#&gt;    4:                  0.022744569      -0.2617714             1                0</span></span>
<span><span class="co">#&gt;    5:                 -1.060445948      -0.1106954             1                0</span></span>
<span><span class="co">#&gt;   ---                                                                            </span></span>
<span><span class="co">#&gt; 4683:                  1.451376301       0.4468886             1                0</span></span>
<span><span class="co">#&gt; 4684:                  0.998302826      -0.2008499             1                0</span></span>
<span><span class="co">#&gt; 4685:                 -1.222499918      -0.3034586             1                0</span></span>
<span><span class="co">#&gt; 4686:                 -0.757142920       0.2353030             1                0</span></span>
<span><span class="co">#&gt; 4687:                 -0.269030636       0.1857979             1                0</span></span>
<span><span class="co">#&gt;       Orbiting.Body.Earth Orbiting.Body..MISSING</span></span>
<span><span class="co">#&gt;    1:                   1                      0</span></span>
<span><span class="co">#&gt;    2:                   1                      0</span></span>
<span><span class="co">#&gt;    3:                   1                      0</span></span>
<span><span class="co">#&gt;    4:                   1                      0</span></span>
<span><span class="co">#&gt;    5:                   1                      0</span></span>
<span><span class="co">#&gt;   ---                                           </span></span>
<span><span class="co">#&gt; 4683:                   1                      0</span></span>
<span><span class="co">#&gt; 4684:                   1                      0</span></span>
<span><span class="co">#&gt; 4685:                   1                      0</span></span>
<span><span class="co">#&gt; 4686:                   1                      0</span></span>
<span><span class="co">#&gt; 4687:                   1                      0</span></span>
<span><span class="va">transformed_task</span><span class="op">$</span><span class="fu">set_row_roles</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Hazardous</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                               <span class="st">"holdout"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv10</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span></span>
<span><span class="va">rf</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="va">measurement</span> <span class="op">=</span>  <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.auc"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">transformed_task</span>,</span>
<span>                        <span class="va">rf</span>, resampling <span class="op">=</span> <span class="va">cv10</span>, store_models <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the average AUC of the holdouts.</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="va">measurement</span><span class="op">)</span></span></code></pre></div>
<p>Very cool! Preprocessing + 10-fold cross-validation model evaluation in a few lines of code!</p>
<p>Let’s create the final predictions:</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">result</span><span class="op">$</span><span class="va">learners</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">transformed_task</span>,</span>
<span>row_ids <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Hazardous</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">prob</span><span class="op">[</span>, <span class="st">"1"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="va">predictions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<p>You could now submit the predictions <a href="http://rhsbio7.uni-regensburg.de:8500" target="_blank" rel="noopener">here</a>.</p>
<p>But we are still not happy with the results, let’s do some hyperparameter tuning!</p>
</div>
<div id="mlr3---hyperparameter-tuning" class="section level3" number="6.2.2">
<h3>
<span class="header-section-number">6.2.2</span> mlr3 - Hyperparameter Tuning<a class="anchor" aria-label="anchor" href="#mlr3---hyperparameter-tuning"><i class="fas fa-link"></i></a>
</h3>
<p>Machine learning algorithms have a varying number of hyperparameters which can (!) have a high impact on the predictive performance. To list a few hyperparameters:</p>
<p><strong>Random Forest</strong></p>
<ul>
<li>mtry</li>
<li>Minimal node size</li>
</ul>
<p><strong>K-nearest-neighbors classification</strong></p>
<ul>
<li>Kernel</li>
<li>Number of neighbors</li>
<li>Distance metric</li>
</ul>
<p><strong>Boosted Regression Tree</strong></p>
<ul>
<li>nrounds</li>
<li>Maximum depth</li>
<li>alpha</li>
<li>booster</li>
<li>eta</li>
<li>gamma</li>
<li>lambda</li>
</ul>
<p>With mlr3, we can easily extend the above example to do hyperparameter tuning within nested cross-validation (the tuning has its own inner cross-validation).</p>
<p>Print the hyperparameter space of our random forest learner:</p>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf</span><span class="op">$</span><span class="va">param_set</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt;                               id    class lower upper nlevels        default    parents</span></span>
<span><span class="co">#&gt;  1:                        alpha ParamDbl  -Inf   Inf     Inf            0.5           </span></span>
<span><span class="co">#&gt;  2:       always.split.variables ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;           </span></span>
<span><span class="co">#&gt;  3:                class.weights ParamUty    NA    NA     Inf                          </span></span>
<span><span class="co">#&gt;  4:                      holdout ParamLgl    NA    NA       2          FALSE           </span></span>
<span><span class="co">#&gt;  5:                   importance ParamFct    NA    NA       4 &lt;NoDefault[3]&gt;           </span></span>
<span><span class="co">#&gt;  6:                   keep.inbag ParamLgl    NA    NA       2          FALSE           </span></span>
<span><span class="co">#&gt;  7:                    max.depth ParamInt     0   Inf     Inf                          </span></span>
<span><span class="co">#&gt;  8:                min.node.size ParamInt     1   Inf     Inf                          </span></span>
<span><span class="co">#&gt;  9:                     min.prop ParamDbl  -Inf   Inf     Inf            0.1           </span></span>
<span><span class="co">#&gt; 10:                      minprop ParamDbl  -Inf   Inf     Inf            0.1           </span></span>
<span><span class="co">#&gt; 11:                         mtry ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt;           </span></span>
<span><span class="co">#&gt; 12:                   mtry.ratio ParamDbl     0     1     Inf &lt;NoDefault[3]&gt;           </span></span>
<span><span class="co">#&gt; 13:            num.random.splits ParamInt     1   Inf     Inf              1  splitrule</span></span>
<span><span class="co">#&gt; 14:                  num.threads ParamInt     1   Inf     Inf              1           </span></span>
<span><span class="co">#&gt; 15:                    num.trees ParamInt     1   Inf     Inf            500           </span></span>
<span><span class="co">#&gt; 16:                    oob.error ParamLgl    NA    NA       2           TRUE           </span></span>
<span><span class="co">#&gt; 17:        regularization.factor ParamUty    NA    NA     Inf              1           </span></span>
<span><span class="co">#&gt; 18:      regularization.usedepth ParamLgl    NA    NA       2          FALSE           </span></span>
<span><span class="co">#&gt; 19:                      replace ParamLgl    NA    NA       2           TRUE           </span></span>
<span><span class="co">#&gt; 20:    respect.unordered.factors ParamFct    NA    NA       3         ignore           </span></span>
<span><span class="co">#&gt; 21:              sample.fraction ParamDbl     0     1     Inf &lt;NoDefault[3]&gt;           </span></span>
<span><span class="co">#&gt; 22:                  save.memory ParamLgl    NA    NA       2          FALSE           </span></span>
<span><span class="co">#&gt; 23: scale.permutation.importance ParamLgl    NA    NA       2          FALSE importance</span></span>
<span><span class="co">#&gt; 24:                    se.method ParamFct    NA    NA       2        infjack           </span></span>
<span><span class="co">#&gt; 25:                         seed ParamInt  -Inf   Inf     Inf                          </span></span>
<span><span class="co">#&gt; 26:         split.select.weights ParamUty    NA    NA     Inf                          </span></span>
<span><span class="co">#&gt; 27:                    splitrule ParamFct    NA    NA       3           gini           </span></span>
<span><span class="co">#&gt; 28:                      verbose ParamLgl    NA    NA       2           TRUE           </span></span>
<span><span class="co">#&gt; 29:                 write.forest ParamLgl    NA    NA       2           TRUE           </span></span>
<span><span class="co">#&gt;                               id    class lower upper nlevels        default    parents</span></span>
<span><span class="co">#&gt;     value</span></span>
<span><span class="co">#&gt;  1:      </span></span>
<span><span class="co">#&gt;  2:      </span></span>
<span><span class="co">#&gt;  3:      </span></span>
<span><span class="co">#&gt;  4:      </span></span>
<span><span class="co">#&gt;  5:      </span></span>
<span><span class="co">#&gt;  6:      </span></span>
<span><span class="co">#&gt;  7:      </span></span>
<span><span class="co">#&gt;  8:      </span></span>
<span><span class="co">#&gt;  9:      </span></span>
<span><span class="co">#&gt; 10:      </span></span>
<span><span class="co">#&gt; 11:      </span></span>
<span><span class="co">#&gt; 12:      </span></span>
<span><span class="co">#&gt; 13:      </span></span>
<span><span class="co">#&gt; 14:     1</span></span>
<span><span class="co">#&gt; 15:      </span></span>
<span><span class="co">#&gt; 16:      </span></span>
<span><span class="co">#&gt; 17:      </span></span>
<span><span class="co">#&gt; 18:      </span></span>
<span><span class="co">#&gt; 19:      </span></span>
<span><span class="co">#&gt; 20:      </span></span>
<span><span class="co">#&gt; 21:      </span></span>
<span><span class="co">#&gt; 22:      </span></span>
<span><span class="co">#&gt; 23:      </span></span>
<span><span class="co">#&gt; 24:      </span></span>
<span><span class="co">#&gt; 25:      </span></span>
<span><span class="co">#&gt; 26:      </span></span>
<span><span class="co">#&gt; 27:      </span></span>
<span><span class="co">#&gt; 28:      </span></span>
<span><span class="co">#&gt; 29:      </span></span>
<span><span class="co">#&gt;     value</span></span></code></pre></div>
<p>Define the hyperparameter space of the random forest:</p>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com">paradox</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_pars</span> <span class="op">=</span> </span>
<span>    <span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamInt.html">ParamInt</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"min.node.size"</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">30L</span><span class="op">)</span>,</span>
<span>           <span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamInt.html">ParamInt</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"mtry"</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">30L</span><span class="op">)</span>,</span>
<span>           <span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamLgl.html">ParamLgl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"regularization.usedepth"</span>, default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rf_pars</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt;                         id    class lower upper nlevels        default value</span></span>
<span><span class="co">#&gt; 1:           min.node.size ParamInt     1    30      30 &lt;NoDefault[3]&gt;      </span></span>
<span><span class="co">#&gt; 2:                    mtry ParamInt     1    30      30 &lt;NoDefault[3]&gt;      </span></span>
<span><span class="co">#&gt; 3: regularization.usedepth ParamLgl    NA    NA       2           TRUE</span></span></code></pre></div>
<p>To set up the tuning pipeline we need:</p>
<ul>
<li>Inner cross-validation resampling object.</li>
<li>Tuning criterion (e.g. AUC).</li>
<li>Tuning method (e.g. random or block search).</li>
<li>Tuning terminator (When should we stop tuning? E.g. after <span class="math inline">\(n\)</span> iterations).</li>
</ul>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inner3</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span>
<span><span class="va">measurement</span> <span class="op">=</span>  <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.auc"</span><span class="op">)</span></span>
<span><span class="va">tuner</span> <span class="op">=</span>  <span class="fu">mlr3tuning</span><span class="fu">::</span><span class="fu"><a href="https://mlr3tuning.mlr-org.com/reference/tnr.html">tnr</a></span><span class="op">(</span><span class="st">"random_search"</span><span class="op">)</span> </span>
<span><span class="va">terminator</span> <span class="op">=</span> <span class="fu">mlr3tuning</span><span class="fu">::</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span>
<span><span class="va">rf</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learner_tuner</span> <span class="op">=</span> <span class="va"><a href="https://mlr3tuning.mlr-org.com/reference/AutoTuner.html">AutoTuner</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>learner <span class="op">=</span> <span class="va">rf</span>, </span>
<span>                              measure <span class="op">=</span> <span class="va">measurement</span>, </span>
<span>                              tuner <span class="op">=</span> <span class="va">tuner</span>, </span>
<span>                              terminator <span class="op">=</span> <span class="va">terminator</span>,</span>
<span>                              search_space <span class="op">=</span> <span class="va">rf_pars</span>,</span>
<span>                              resampling <span class="op">=</span> <span class="va">inner3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">learner_tuner</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;AutoTuner:classif.ranger.tuned&gt;</span></span>
<span><span class="co">#&gt; * Model: -</span></span>
<span><span class="co">#&gt; * Search Space:</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt;                         id    class lower upper nlevels        default value</span></span>
<span><span class="co">#&gt; 1:           min.node.size ParamInt     1    30      30 &lt;NoDefault[3]&gt;      </span></span>
<span><span class="co">#&gt; 2:                    mtry ParamInt     1    30      30 &lt;NoDefault[3]&gt;      </span></span>
<span><span class="co">#&gt; 3: regularization.usedepth ParamLgl    NA    NA       2           TRUE      </span></span>
<span><span class="co">#&gt; * Packages: mlr3, mlr3tuning, mlr3learners, ranger</span></span>
<span><span class="co">#&gt; * Predict Type: prob</span></span>
<span><span class="co">#&gt; * Feature Types: logical, integer, numeric, character, factor, ordered</span></span>
<span><span class="co">#&gt; * Properties: hotstart_backward, importance, multiclass, oob_error, twoclass,</span></span>
<span><span class="co">#&gt;   weights</span></span></code></pre></div>
<p>Now we can wrap it normally into the 10-fold cross-validated setup as done previously:</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outer3</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">transformed_task</span>, <span class="va">learner_tuner</span>,</span>
<span>                        resampling <span class="op">=</span> <span class="va">outer3</span>, store_models <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the average AUC of the holdouts.</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="va">measurement</span><span class="op">)</span></span></code></pre></div>
<p>Yeah, we were able to improve the performance!</p>
<p>Let’s create the final predictions:</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">result</span><span class="op">$</span><span class="va">learners</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">transformed_task</span>,</span>
<span>row_ids <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Hazardous</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">prob</span><span class="op">[</span>, <span class="st">"1"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="va">predictions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="mlr3---hyperparameter-tuning-with-oversampling" class="section level3" number="6.2.3">
<h3>
<span class="header-section-number">6.2.3</span> mlr3 - Hyperparameter Tuning with Oversampling<a class="anchor" aria-label="anchor" href="#mlr3---hyperparameter-tuning-with-oversampling"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s go one step back, maybe you have noticed that our classes are unbalanced:</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Hazardous</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 412  88</span></span></code></pre></div>
<p>Many machine learning algorithms have problems with unbalanced data because if the imbalance is too strong it is cheaper for the algorithm to focus on only one class (e.g. by predicting only 0s or 1s). You need to keep in mind that machine learning algorithms are greedy and their main focus is to minimize the loss function.</p>
<p>There are few techniques to correct for imbalance:</p>
<ul>
<li>Oversampling (oversample the undersampled class).</li>
<li>Undersampling (undersample the oversampled class).</li>
<li>SMOTE <em>Synthetic Minority Over-sampling Technique</em> (very briefly, we will use a k-nearest-neighbors classification to create new samples around our undersampled class).</li>
</ul>
<p>Here, we will use oversampling which we can do by extending our random forest learner:</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_over</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"classbalancing"</span>, id <span class="op">=</span> <span class="st">"over"</span>, adjust <span class="op">=</span> <span class="st">"minor"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="va">rf</span></span>
<span></span>
<span><span class="co"># However rf_over is now a "graph",</span></span>
<span><span class="co"># but we can easily transform it back into a learner:</span></span>
<span><span class="va">rf_over_learner</span> <span class="op">=</span> <span class="va"><a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html">GraphLearner</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">rf_over</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rf_over_learner</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;GraphLearner:over.classif.ranger&gt;</span></span>
<span><span class="co">#&gt; * Model: -</span></span>
<span><span class="co">#&gt; * Parameters: over.ratio=1, over.reference=all, over.adjust=minor,</span></span>
<span><span class="co">#&gt;   over.shuffle=TRUE, classif.ranger.num.threads=1</span></span>
<span><span class="co">#&gt; * Packages: mlr3, mlr3pipelines, mlr3learners, ranger</span></span>
<span><span class="co">#&gt; * Predict Type: prob</span></span>
<span><span class="co">#&gt; * Feature types: logical, integer, numeric, character, factor, ordered, POSIXct</span></span>
<span><span class="co">#&gt; * Properties: featureless, hotstart_backward, hotstart_forward, importance,</span></span>
<span><span class="co">#&gt;   loglik, missings, multiclass, oob_error, selected_features, twoclass, weights</span></span></code></pre></div>
<p>The learner has now a new feature space:</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_over_learner</span><span class="op">$</span><span class="va">param_set</span></span>
<span><span class="co">#&gt; &lt;ParamSetCollection&gt;</span></span>
<span><span class="co">#&gt;                                              id    class lower upper nlevels</span></span>
<span><span class="co">#&gt;  1:                        classif.ranger.alpha ParamDbl  -Inf   Inf     Inf</span></span>
<span><span class="co">#&gt;  2:       classif.ranger.always.split.variables ParamUty    NA    NA     Inf</span></span>
<span><span class="co">#&gt;  3:                classif.ranger.class.weights ParamUty    NA    NA     Inf</span></span>
<span><span class="co">#&gt;  4:                      classif.ranger.holdout ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt;  5:                   classif.ranger.importance ParamFct    NA    NA       4</span></span>
<span><span class="co">#&gt;  6:                   classif.ranger.keep.inbag ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt;  7:                    classif.ranger.max.depth ParamInt     0   Inf     Inf</span></span>
<span><span class="co">#&gt;  8:                classif.ranger.min.node.size ParamInt     1   Inf     Inf</span></span>
<span><span class="co">#&gt;  9:                     classif.ranger.min.prop ParamDbl  -Inf   Inf     Inf</span></span>
<span><span class="co">#&gt; 10:                      classif.ranger.minprop ParamDbl  -Inf   Inf     Inf</span></span>
<span><span class="co">#&gt; 11:                         classif.ranger.mtry ParamInt     1   Inf     Inf</span></span>
<span><span class="co">#&gt; 12:                   classif.ranger.mtry.ratio ParamDbl     0     1     Inf</span></span>
<span><span class="co">#&gt; 13:            classif.ranger.num.random.splits ParamInt     1   Inf     Inf</span></span>
<span><span class="co">#&gt; 14:                  classif.ranger.num.threads ParamInt     1   Inf     Inf</span></span>
<span><span class="co">#&gt; 15:                    classif.ranger.num.trees ParamInt     1   Inf     Inf</span></span>
<span><span class="co">#&gt; 16:                    classif.ranger.oob.error ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt; 17:        classif.ranger.regularization.factor ParamUty    NA    NA     Inf</span></span>
<span><span class="co">#&gt; 18:      classif.ranger.regularization.usedepth ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt; 19:                      classif.ranger.replace ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt; 20:    classif.ranger.respect.unordered.factors ParamFct    NA    NA       3</span></span>
<span><span class="co">#&gt; 21:              classif.ranger.sample.fraction ParamDbl     0     1     Inf</span></span>
<span><span class="co">#&gt; 22:                  classif.ranger.save.memory ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt; 23: classif.ranger.scale.permutation.importance ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt; 24:                    classif.ranger.se.method ParamFct    NA    NA       2</span></span>
<span><span class="co">#&gt; 25:                         classif.ranger.seed ParamInt  -Inf   Inf     Inf</span></span>
<span><span class="co">#&gt; 26:         classif.ranger.split.select.weights ParamUty    NA    NA     Inf</span></span>
<span><span class="co">#&gt; 27:                    classif.ranger.splitrule ParamFct    NA    NA       3</span></span>
<span><span class="co">#&gt; 28:                      classif.ranger.verbose ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt; 29:                 classif.ranger.write.forest ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt; 30:                                 over.adjust ParamFct    NA    NA       7</span></span>
<span><span class="co">#&gt; 31:                                  over.ratio ParamDbl     0   Inf     Inf</span></span>
<span><span class="co">#&gt; 32:                              over.reference ParamFct    NA    NA       6</span></span>
<span><span class="co">#&gt; 33:                                over.shuffle ParamLgl    NA    NA       2</span></span>
<span><span class="co">#&gt;                                              id    class lower upper nlevels</span></span>
<span><span class="co">#&gt;            default                   parents value</span></span>
<span><span class="co">#&gt;  1:            0.5                                </span></span>
<span><span class="co">#&gt;  2: &lt;NoDefault[3]&gt;                                </span></span>
<span><span class="co">#&gt;  3:                                               </span></span>
<span><span class="co">#&gt;  4:          FALSE                                </span></span>
<span><span class="co">#&gt;  5: &lt;NoDefault[3]&gt;                                </span></span>
<span><span class="co">#&gt;  6:          FALSE                                </span></span>
<span><span class="co">#&gt;  7:                                               </span></span>
<span><span class="co">#&gt;  8:                                               </span></span>
<span><span class="co">#&gt;  9:            0.1                                </span></span>
<span><span class="co">#&gt; 10:            0.1                                </span></span>
<span><span class="co">#&gt; 11: &lt;NoDefault[3]&gt;                                </span></span>
<span><span class="co">#&gt; 12: &lt;NoDefault[3]&gt;                                </span></span>
<span><span class="co">#&gt; 13:              1  classif.ranger.splitrule      </span></span>
<span><span class="co">#&gt; 14:              1                               1</span></span>
<span><span class="co">#&gt; 15:            500                                </span></span>
<span><span class="co">#&gt; 16:           TRUE                                </span></span>
<span><span class="co">#&gt; 17:              1                                </span></span>
<span><span class="co">#&gt; 18:          FALSE                                </span></span>
<span><span class="co">#&gt; 19:           TRUE                                </span></span>
<span><span class="co">#&gt; 20:         ignore                                </span></span>
<span><span class="co">#&gt; 21: &lt;NoDefault[3]&gt;                                </span></span>
<span><span class="co">#&gt; 22:          FALSE                                </span></span>
<span><span class="co">#&gt; 23:          FALSE classif.ranger.importance      </span></span>
<span><span class="co">#&gt; 24:        infjack                                </span></span>
<span><span class="co">#&gt; 25:                                               </span></span>
<span><span class="co">#&gt; 26:                                               </span></span>
<span><span class="co">#&gt; 27:           gini                                </span></span>
<span><span class="co">#&gt; 28:           TRUE                                </span></span>
<span><span class="co">#&gt; 29:           TRUE                                </span></span>
<span><span class="co">#&gt; 30: &lt;NoDefault[3]&gt;                           minor</span></span>
<span><span class="co">#&gt; 31: &lt;NoDefault[3]&gt;                               1</span></span>
<span><span class="co">#&gt; 32: &lt;NoDefault[3]&gt;                             all</span></span>
<span><span class="co">#&gt; 33: &lt;NoDefault[3]&gt;                            TRUE</span></span>
<span><span class="co">#&gt;            default                   parents value</span></span></code></pre></div>
<p>We can also tune the oversampling rate!</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_pars_over</span> <span class="op">=</span> </span>
<span>    <span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamInt.html">ParamInt</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"over.ratio"</span>, lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">7L</span><span class="op">)</span>,</span>
<span>           <span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamInt.html">ParamInt</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"classif.ranger.min.node.size"</span>,</span>
<span>                                 lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">30L</span><span class="op">)</span>,</span>
<span>           <span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamInt.html">ParamInt</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"classif.ranger.mtry"</span>, lower <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 upper <span class="op">=</span> <span class="fl">30L</span><span class="op">)</span>,</span>
<span>           <span class="fu">paradox</span><span class="fu">::</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamLgl.html">ParamLgl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"classif.ranger.regularization.usedepth"</span>,</span>
<span>                                 default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inner3</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span>
<span><span class="va">measurement</span> <span class="op">=</span>  <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.auc"</span><span class="op">)</span></span>
<span><span class="va">tuner</span> <span class="op">=</span>  <span class="fu">mlr3tuning</span><span class="fu">::</span><span class="fu"><a href="https://mlr3tuning.mlr-org.com/reference/tnr.html">tnr</a></span><span class="op">(</span><span class="st">"random_search"</span><span class="op">)</span> </span>
<span><span class="va">terminator</span> <span class="op">=</span> <span class="fu">mlr3tuning</span><span class="fu">::</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learner_tuner_over</span> <span class="op">=</span> <span class="va"><a href="https://mlr3tuning.mlr-org.com/reference/AutoTuner.html">AutoTuner</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>learner <span class="op">=</span> <span class="va">rf_over_learner</span>, </span>
<span>                                   measure <span class="op">=</span> <span class="va">measurement</span>, </span>
<span>                                   tuner <span class="op">=</span> <span class="va">tuner</span>, </span>
<span>                                   terminator <span class="op">=</span> <span class="va">terminator</span>,</span>
<span>                                   search_space <span class="op">=</span> <span class="va">rf_pars_over</span>,</span>
<span>                                   resampling <span class="op">=</span> <span class="va">inner3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">learner_tuner</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;AutoTuner:classif.ranger.tuned&gt;</span></span>
<span><span class="co">#&gt; * Model: -</span></span>
<span><span class="co">#&gt; * Search Space:</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt;                         id    class lower upper nlevels        default value</span></span>
<span><span class="co">#&gt; 1:           min.node.size ParamInt     1    30      30 &lt;NoDefault[3]&gt;      </span></span>
<span><span class="co">#&gt; 2:                    mtry ParamInt     1    30      30 &lt;NoDefault[3]&gt;      </span></span>
<span><span class="co">#&gt; 3: regularization.usedepth ParamLgl    NA    NA       2           TRUE      </span></span>
<span><span class="co">#&gt; * Packages: mlr3, mlr3tuning, mlr3learners, ranger</span></span>
<span><span class="co">#&gt; * Predict Type: prob</span></span>
<span><span class="co">#&gt; * Feature Types: logical, integer, numeric, character, factor, ordered</span></span>
<span><span class="co">#&gt; * Properties: hotstart_backward, importance, multiclass, oob_error, twoclass,</span></span>
<span><span class="co">#&gt;   weights</span></span></code></pre></div>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outer3</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">transformed_task</span>, <span class="va">learner_tuner_over</span>,</span>
<span>                        resampling <span class="op">=</span> <span class="va">outer3</span>, store_models <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the average AUC of the holdouts.</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="va">measurement</span><span class="op">)</span></span></code></pre></div>
<p>5 iterations in the hyperspace is not very much…</p>
<p>Let’s create the final predictions:</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">result</span><span class="op">$</span><span class="va">learners</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">transformed_task</span>,</span>
<span>row_ids <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Hazardous</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">prob</span><span class="op">[</span>, <span class="st">"1"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="va">predictions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
  <hr>
<strong><span style="color: #0011AA; font-size:18px;">Optional bonus task</span></strong><br><p>After reading the above chapter about the mlr package, try to transfer it to the titanic data set (use the titanic_ml data set, this has already NAs for the values to predict).
Alternatively, you can also use other data sets from our challenge (e.g. the plant-pollinator data set, see the data set chapter <a href="#datasets"><strong>??</strong></a>).</p>
  <details><summary><strong><span style="color: #0011AA; font-size:18px;">Solution</span></strong>
    </summary><p>
</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TheoreticalEcology/">EcoData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https:///mlr3measures.mlr-org.com">mlr3measures</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">titanic_ml</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">titanic_ml</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1309 obs. of  14 variables:</span></span>
<span><span class="co">#&gt;  $ pclass   : int  2 1 3 3 3 3 3 1 3 1 ...</span></span>
<span><span class="co">#&gt;  $ survived : int  1 1 0 0 0 0 0 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ name     : chr  "Sinkkonen, Miss. Anna" "Woolner, Mr. Hugh" "Sage, Mr. Douglas Bullen" "Palsson, Master. Paul Folke" ...</span></span>
<span><span class="co">#&gt;  $ sex      : Factor w/ 2 levels "female","male": 1 2 2 2 2 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ age      : num  30 NA NA 6 30.5 38.5 20 53 NA 42 ...</span></span>
<span><span class="co">#&gt;  $ sibsp    : int  0 0 8 3 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ parch    : int  0 0 2 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ ticket   : Factor w/ 929 levels "110152","110413",..: 221 123 779 542 589 873 472 823 588 834 ...</span></span>
<span><span class="co">#&gt;  $ fare     : num  13 35.5 69.55 21.07 8.05 ...</span></span>
<span><span class="co">#&gt;  $ cabin    : Factor w/ 187 levels "","A10","A11",..: 1 94 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ embarked : Factor w/ 4 levels "","C","Q","S": 4 4 4 4 4 4 4 2 4 2 ...</span></span>
<span><span class="co">#&gt;  $ boat     : Factor w/ 28 levels "","1","10","11",..: 3 28 1 1 1 1 1 19 1 15 ...</span></span>
<span><span class="co">#&gt;  $ body     : int  NA NA NA NA 50 32 NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ home.dest: Factor w/ 370 levels "","?Havana, Cuba",..: 121 213 1 1 1 1 322 350 1 1 ...</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">titanic_ml</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">name</span>, <span class="op">-</span><span class="va">ticket</span>, <span class="op">-</span><span class="va">name</span>, <span class="op">-</span><span class="va">body</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">pclass</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">survived</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change easy things manually:</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">embarked</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">embarked</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">=</span> <span class="st">"S"</span>  <span class="co"># Fill in "empty" values.</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">embarked</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">embarked</span><span class="op">)</span><span class="op">)</span> <span class="co"># Remove unused levels ("").</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">cabin</span> <span class="op">=</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cabin</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span> <span class="co"># Dummy code the availability of a cabin.</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">fare</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">fare</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">fare</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">home.dest</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">home.dest</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">=</span> <span class="st">"unknown"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">boat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">boat</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">=</span> <span class="st">"none"</span></span>
<span></span>
<span><span class="co"># Create a classification task.</span></span>
<span><span class="va">task</span> <span class="op">=</span> <span class="va"><a href="https://mlr3.mlr-org.com/reference/TaskClassif.html">TaskClassif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"titanic"</span>, backend <span class="op">=</span> <span class="va">data</span>,</span>
<span>                       target <span class="op">=</span> <span class="st">"survived"</span>, positive <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span></span>
<span><span class="va">task</span><span class="op">$</span><span class="fu">missings</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  survived       age      boat     cabin  embarked      fare home.dest     parch    pclass </span></span>
<span><span class="co">#&gt;       655       263         0         0         0         0         0         0         0 </span></span>
<span><span class="co">#&gt;       sex     sibsp </span></span>
<span><span class="co">#&gt;         0         0</span></span>
<span></span>
<span><span class="co"># Let's create the preprocessing graph.</span></span>
<span><span class="va">preprocessing</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"imputeoor"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"encode"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Run the task.</span></span>
<span><span class="va">transformed_task</span> <span class="op">=</span> <span class="va">preprocessing</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">transformed_task</span><span class="op">$</span><span class="fu">set_row_roles</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">survived</span><span class="op">)</span><span class="op">]</span>, <span class="st">"holdout"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv10</span> <span class="op">=</span> <span class="fu">mlr3</span><span class="fu">::</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span></span>
<span><span class="va">rf</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="va">measurement</span> <span class="op">=</span>  <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.auc"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># result = mlr3::resample(transformed_task, rf,</span></span>
<span><span class="co">#                         resampling = cv10, store_models = TRUE)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># # Calculate the average AUC of the holdouts.</span></span>
<span><span class="co"># result$aggregate(measurement)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># pred = sapply(1:10, function(i) result$learners[[i]]$predict(transformed_task,</span></span>
<span><span class="co"># row_ids = (1:nrow(data))[is.na(data$survived)])$data$prob[, "1", drop = FALSE])</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># dim(pred)</span></span>
<span><span class="co"># predictions = round(apply(pred, 1, mean))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># write.csv(data.frame(y = predictions), file = "submission_RF.csv")</span></span></code></pre></div>
    
  </details><br><hr>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="fundamental.html"><span class="header-section-number">5</span> Common Machine Learning algorithms</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#workflow"><span class="header-section-number">6</span> Machine Learning workflow</a></li>
<li>
<a class="nav-link" href="#the-standard-machine-learning-pipeline-at-the-eexample-of-the-titanic-data-set"><span class="header-section-number">6.1</span> The Standard Machine Learning Pipeline at the Eexample of the Titanic Data set</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-cleaning"><span class="header-section-number">6.1.1</span> Data Cleaning</a></li>
<li><a class="nav-link" href="#preprocessing-and-feature-selection"><span class="header-section-number">6.1.2</span> Preprocessing and Feature Selection</a></li>
<li><a class="nav-link" href="#split-data"><span class="header-section-number">6.1.3</span> Split Data</a></li>
<li><a class="nav-link" href="#training"><span class="header-section-number">6.1.4</span> Training</a></li>
<li><a class="nav-link" href="#evaluation"><span class="header-section-number">6.1.5</span> Evaluation</a></li>
<li><a class="nav-link" href="#predictions-and-submission"><span class="header-section-number">6.1.6</span> Predictions and Submission</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#mlr"><span class="header-section-number">6.2</span> Bonus - Machine Learning Pipelines with mlr3</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#mlr3---the-basic-workflow"><span class="header-section-number">6.2.1</span> mlr3 - The Basic Workflow</a></li>
<li><a class="nav-link" href="#mlr3---hyperparameter-tuning"><span class="header-section-number">6.2.2</span> mlr3 - Hyperparameter Tuning</a></li>
<li><a class="nav-link" href="#mlr3---hyperparameter-tuning-with-oversampling"><span class="header-section-number">6.2.3</span> mlr3 - Hyperparameter Tuning with Oversampling</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/TheoreticalEcology/machinelearning/blob/master/book/06-ML_workflow.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/TheoreticalEcology/machinelearning/edit/master/book/06-ML_workflow.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Machine Learning and AI in TensorFlow and R</strong>" was written by Maximilian Pichler and Florian Hartig. It was last built on 2022-07-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
